WITH PRIMEIRA_FILIAL AS (
	SELECT F.ID_EMPRESA,
	       MIN(F.ID_FILIAL) AS ID_FILIAL
	FROM FILIAIS AS F
	GROUP BY F.ID_EMPRESA
)
SELECT EMPRESAS.*,
       FILIAIS.*,
	   RESP.NOME AS NOME_RESP,
	   RESP.CPF AS CPF_RESP,
	   RESP.RG AS RG_RESP,
	   RESP.ENDERECO AS ENDERECO_RESP,
	   RESP.UF AS UF_RESP,
       RESP.CEP AS CEP_RESP,
	   RESP.NUMERO AS NUMERO_RESP,
	   RESP.BAIRRO AS BAIRRO_RESP,
	   RESP.FONE AS FONE_RESP,
	   RESP.EMAIL AS EMAIL_RESP,
	   MUNICIPIOS.NOME AS CIDADE,
	   MUNICIPIOS.COD_IBGE
FROM EMPRESAS
INNER JOIN PRIMEIRA_FILIAL
	ON PRIMEIRA_FILIAL.ID_EMPRESA = EMPRESAS.ID_EMPRESA
INNER JOIN FILIAIS
	ON FILIAIS.ID_EMPRESA = EMPRESAS.ID_EMPRESA
	AND FILIAIS.ID_FILIAL = PRIMEIRA_FILIAL.ID_FILIAL
LEFT JOIN RESPONSAVEIS_SOCIOS AS RESP
	ON RESP.ID_RESPONSAVEL = EMPRESAS.ID_RESPONSAVEL
LEFT JOIN MUNICIPIOS
	ON MUNICIPIOS.CMUCOD = FILIAIS.COD_MUNICIPIO