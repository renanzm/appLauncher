SELECT DISTINCT
BPM_PESSOA.IDPESSOA,
BPM_PESSOA.CODIGOPESSOA,
BPM_PESSOA.NOMEPESSOA,
BPM_DADOSPESSOAJURIDICA.NOMEABREVIADO,
BPM_DADOSPESSOAJURIDICA.NOMEFANTASIA,
BPM_DADOSPESSOAJURIDICA.CNPJ,
BPM_PESSOA.NUMEROCEI,
BPM_DADOSPESSOAJURIDICA.INSCRICAOESTADUAL,
BPM_DADOSPESSOAJURIDICA.INSCRICAOMUNICIPAL,
BPM_DADOSPESSOAJURIDICA.NUMEROREGISTROJUNTA,
BPM_DADOSPESSOAJURIDICA.DATAREGISTROJUNTA,
BPM_DADOSPESSOAJURIDICA.NOMEJUNTA,
BPM_DADOSPESSOAJURIDICA.DATAINICIOATIVIDADE,
BPM_DADOSPESSOAJURIDICA.DATATERMINOSOCIEDADE,
BPM_DADOSPESSOAJURIDICA.CAPITALSOCIALINICIAL,
BPM_DADOSPESSOAJURIDICA.DATAFUNDACAO,
BPM_DADOSPESSOAJURIDICA.DATAFIMATIVIDADE,
BPM_DADOSPESSOAJURIDICA.NIRC,
(SELECT DOM_NATUREZAJURIDICA.CODIGONATUREZAJURIDICA FROM NG_DOMINIO.DBO.DOM_NATUREZAJURIDICA WHERE BPM_DADOSPESSOAJURIDICA.IDNATUREZAJURIDICA = DOM_NATUREZAJURIDICA.IDNATUREZAJURIDICA) AS NATUREZAJURIDICA,
BPM_DADOSPESSOAJURIDICA.CODIGOSUFRAMA,
(SELECT DOM_TIPOLOGRADOURO.DESCRICAOTIPOLOGRADOURO FROM NG_DOMINIO.DBO.DOM_TIPOLOGRADOURO WHERE BPM_PESSOAENDERECO.IDTIPOLOGRADOURO = DOM_TIPOLOGRADOURO.IDTIPOLOGRADOURO) AS TIPOLOGRADOURO,
(SELECT DOM_TITULOLOGRADOURO.DESCRICAOTITULOLOGRADOURO FROM NG_DOMINIO.DBO.DOM_TITULOLOGRADOURO WHERE BPM_PESSOAENDERECO.IDTITULOLOGRADOURO = DOM_TITULOLOGRADOURO.IDTITULOLOGRADOURO) AS TITULOLOGRADOURO,
BPM_PESSOAENDERECO.LOGRADOURO,
BPM_PESSOAENDERECO.NUMEROENDERECO,
BPM_PESSOAENDERECO.COMPLEMENTO,
BPM_PESSOAENDERECO.BAIRRO,
(SELECT DOM_MUNICIPIO.CODIGOIBGE FROM NG_DOMINIO.DBO.DOM_MUNICIPIO WHERE BPM_PESSOAENDERECO.IDMUNICIPIO = DOM_MUNICIPIO.IDMUNICIPIO) AS CODIGOIBGE,
(SELECT DOM_MUNICIPIO.NOMEMUNICIPIO FROM NG_DOMINIO.DBO.DOM_MUNICIPIO WHERE BPM_PESSOAENDERECO.IDMUNICIPIO = DOM_MUNICIPIO.IDMUNICIPIO) AS CIDADE,
NG_DOMINIO.DBO.DOM_UF.ABREVIATURAUF AS ESTADO,
BPM_PESSOAENDERECO.CEP,
BPM_PESSOAENDERECO.CAIXAPOSTAL,
(SELECT CONT1.DESCRICAOTIPOCONTATO
   FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT1
  WHERE CONT1.IDTIPOCONTATO = 1
    AND CONT1.IDPESSOA = BPM_DADOSPESSOAJURIDICA.IDPESSOA
	AND CONT1.IDPESSOATIPOCONTATO = (SELECT MAX(CONT2.IDPESSOATIPOCONTATO)
                               FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT2
                              WHERE CONT2.IDTIPOCONTATO = CONT1.IDTIPOCONTATO
                                AND CONT2.IDPESSOA = CONT1.IDPESSOA)) AS TELEFONE1,
(SELECT CONT1.DESCRICAOTIPOCONTATO
   FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT1
  WHERE CONT1.IDTIPOCONTATO = 2
    AND CONT1.IDPESSOA = BPM_DADOSPESSOAJURIDICA.IDPESSOA
	AND CONT1.IDPESSOATIPOCONTATO = (SELECT MAX(CONT2.IDPESSOATIPOCONTATO)
                               FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT2
                              WHERE CONT2.IDTIPOCONTATO = CONT1.IDTIPOCONTATO
                                AND CONT2.IDPESSOA = CONT1.IDPESSOA)) AS TELEFONE2,
(SELECT CONT1.DESCRICAOTIPOCONTATO
   FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT1
  WHERE CONT1.IDTIPOCONTATO = 4
    AND CONT1.IDPESSOA = BPM_DADOSPESSOAJURIDICA.IDPESSOA
	AND CONT1.IDPESSOATIPOCONTATO = (SELECT MAX(CONT2.IDPESSOATIPOCONTATO)
                               FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT2
                              WHERE CONT2.IDTIPOCONTATO = CONT1.IDTIPOCONTATO
                                AND CONT2.IDPESSOA = CONT1.IDPESSOA)) AS FAX,
(SELECT CONT1.DESCRICAOTIPOCONTATO
   FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT1
  WHERE CONT1.IDTIPOCONTATO = 10
    AND CONT1.IDPESSOA = BPM_DADOSPESSOAJURIDICA.IDPESSOA
	AND CONT1.IDPESSOATIPOCONTATO = (SELECT MAX(CONT2.IDPESSOATIPOCONTATO)
                               FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT2
                              WHERE CONT2.IDTIPOCONTATO = CONT1.IDTIPOCONTATO
                                AND CONT2.IDPESSOA = CONT1.IDPESSOA)) AS PAGINA,
(SELECT CONT1.DESCRICAOTIPOCONTATO
   FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT1
  WHERE CONT1.IDTIPOCONTATO = 3
    AND CONT1.IDPESSOA = BPM_DADOSPESSOAJURIDICA.IDPESSOA
	AND CONT1.DATAHORALOG = (SELECT MAX(CONT2.DATAHORALOG)
                               FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT2
                              WHERE CONT2.IDTIPOCONTATO = 1
                                AND CONT2.IDPESSOA = BPM_DADOSPESSOAJURIDICA.IDPESSOA)
	AND CONT1.IDPESSOATIPOCONTATO = (SELECT MAX(CONT2.IDPESSOATIPOCONTATO)
                               FROM NG.DBO.BPM_PESSOATIPOCONTATO AS CONT2
                              WHERE CONT2.IDTIPOCONTATO = CONT1.IDTIPOCONTATO
                                AND CONT2.IDPESSOA = CONT1.IDPESSOA)) AS EMAIL,
(SELECT DOM_CNAE.SUBCLASSEANTERIOR FROM NG_DOMINIO.DBO.DOM_CNAE WHERE BPM_DADOSPESSOAJURIDICACNAE.IDCNAE = DOM_CNAE.IDCNAE) AS CNAE,
(SELECT DOM_CNAE.SUBCLASSE FROM NG_DOMINIO.DBO.DOM_CNAE WHERE BPM_DADOSPESSOAJURIDICACNAE.IDCNAE = DOM_CNAE.IDCNAE) AS CNAE20,
BPM_DADOSEMPRESAFOLHA.INDFILIADASINDICATO,
BPM_DADOSEMPRESAFOLHA.CONTAFGTS,
(SELECT CODIGOFPAS FROM NG_DOMINIO.DBO.DOM_FPAS WHERE DOM_FPAS.IDFPAS = BPM_DADOSEMPRESAFOLHA.IDFPAS) AS FPAS,
(SELECT CODIGOTERCEIRO FROM NG_DOMINIO.DBO.DOM_CODIGOTERCEIRO WHERE DOM_CODIGOTERCEIRO.IDCODIGOTERCEIRO = DADOSSERVICOS.IDCODIGOSTERCEIROS) AS CODIGOSTERCEIROS,
DADOSSERVICOS.PERCENTUALTERCEIRO,
(SELECT CODIGOGPS FROM NG_DOMINIO.DBO.DOM_CODIGOGPS WHERE DOM_CODIGOGPS.IDCODIGOGPS = DADOSSERVICOS.IDCODIGOGPS) AS CODIGOGPS,
DADOSSERVICOS.PERCENTUALRAT,
DADOSSERVICOS.PERCENTUALINSS,
BPM_DADOSEMPRESAFOLHA.INDATIVO,
BPM_PESSOA.CAEPF,
BPM_PESSOA.IDTIPOCAEPF,
( SELECT MAX(IDDADOSCONTADOR)
    FROM NG.DBO.BPM_PESSOARELACIONAMENTO,
	     NG.DBO.BPM_DADOSCONTADOR
   WHERE IDTIPORELACIONAMENTOPESSOA = 10
     AND IDPESSOASECUNDARIA = NG.DBO.BPM_DADOSCONTADOR.IDPESSOA
	 AND IDPESSOAPRINCIPAL  = BPM_PESSOA.IDPESSOA) AS CONTADOR

FROM NG.DBO.BPM_PESSOA INNER JOIN NG.DBO.BPM_DADOSPESSOAJURIDICA ON BPM_DADOSPESSOAJURIDICA.IDPESSOA = BPM_PESSOA.IDPESSOA

LEFT JOIN NG.DBO.BPM_DADOSEMPRESAFOLHA  ON BPM_PESSOA.IDPESSOA = BPM_DADOSEMPRESAFOLHA.IDPESSOA

LEFT JOIN NG.DBO.BPM_DADOSEMPRESACONTABIL ON BPM_PESSOA.IDPESSOA = BPM_DADOSEMPRESACONTABIL.IDPESSOA

LEFT JOIN NG.DBO.BPM_DADOSEMPRESAFISCAL ON BPM_PESSOA.IDPESSOA = BPM_DADOSEMPRESAFISCAL.IDPESSOA

LEFT JOIN NG.DBO.BPM_PESSOAENDERECO AS PESSOAENDERECO ON PESSOAENDERECO.IDPESSOA = NG.DBO.BPM_PESSOA.IDPESSOA

LEFT JOIN NG_DOMINIO.DBO.DOM_MUNICIPIO ON NG_DOMINIO.DBO.DOM_MUNICIPIO.IDMUNICIPIO = PESSOAENDERECO.IDMUNICIPIO

LEFT JOIN NG_DOMINIO.DBO.DOM_UF ON NG_DOMINIO.DBO.DOM_UF.IDUF = NG_DOMINIO.DBO.DOM_MUNICIPIO.IDUF

/* VINCULA COM O PRINCIPAL (INDPRINCIPAL = 1) ENDERECO COMERCIAL (IDTIPOENDERECO = 2) */
LEFT OUTER JOIN NG.DBO.BPM_PESSOAENDERECO
ON BPM_PESSOAENDERECO.IDPESSOA = BPM_PESSOA.IDPESSOA
AND BPM_PESSOAENDERECO.INDPRINCIPAL = 1
AND BPM_PESSOAENDERECO.IDTIPOENDERECO = 2

LEFT OUTER JOIN NG.DBO.BPM_DADOSPESSOAJURIDICACNAE
ON BPM_DADOSPESSOAJURIDICACNAE.IDPESSOA = BPM_PESSOA.IDPESSOA
AND BPM_DADOSPESSOAJURIDICACNAE.INDPRINCIPAL = 1

LEFT OUTER JOIN (SELECT FORMATRIBUTACAO.IDPESSOA,
				    	FORMATRIBUTACAO.ANO,
					    COMPLEMENTOFOLHA.IDCODIGOGPS,
					    COMPLEMENTOFOLHA.IDCODIGOSTERCEIROS,
					    COMPLEMENTOFOLHA.IDOPTANTESIMPLES,
					    COMPLEMENTOFOLHA.PERCENTUALRAT,
					    COMPLEMENTOFOLHA.PERCENTUALTERCEIRO,
					    COMPLEMENTOFOLHA.PERCENTUALINSS,
					    COMPLEMENTOFOLHA.FAP,
					    COMPLEMENTOFOLHA.IDUSUARIOLOG,
					    COMPLEMENTOFOLHA.DATAHORALOG

					    FROM NG.DBO.BPM_DADOSEMPRESAFORMATRIBUTACAOCOMPLEMENTOFOLHA AS COMPLEMENTOFOLHA,
					    (SELECT BPM_DADOSEMPRESAFORMATRIBUTACAO.IDDADOSEMPRESAFORMATRIBUTACAO,
						    	BPM_DADOSEMPRESAFORMATRIBUTACAO.IDFORMATRIBUTACAO,
							    BPM_DADOSEMPRESAFORMATRIBUTACAO.IDPESSOA,
							    BPM_DADOSEMPRESAFORMATRIBUTACAO.ANO
					            FROM NG.DBO.BPM_DADOSEMPRESAFORMATRIBUTACAO) AS FORMATRIBUTACAO
					      WHERE COMPLEMENTOFOLHA.IDDADOSEMPRESAFORMATRIBUTACAO = FORMATRIBUTACAO.IDDADOSEMPRESAFORMATRIBUTACAO
					        AND FORMATRIBUTACAO.ANO = (SELECT MAX(FORMATRIBUTACAOAUX.ANO)
							        					 FROM NG.DBO.BPM_DADOSEMPRESAFORMATRIBUTACAO AS FORMATRIBUTACAOAUX
												        WHERE FORMATRIBUTACAOAUX.IDPESSOA = FORMATRIBUTACAO.IDPESSOA)) AS DADOSSERVICOS

ON DADOSSERVICOS.IDPESSOA = BPM_PESSOA.IDPESSOA

WHERE (NOT BPM_DADOSEMPRESACONTABIL.IDPESSOA IS NULL
OR NOT BPM_DADOSEMPRESAFISCAL.IDPESSOA IS NULL
OR NOT BPM_DADOSEMPRESAFOLHA.IDPESSOA IS NULL)

ORDER BY 1