/* MEDIAS FERIAS */
SELECT DISTINCT EMP.IDOWNER,
       EMP.CODIGOREGISTRO,
	   RUB.CODIGOVERBA, 
	   RUB.DESCRICAOVERBA,
	   SIND.IDTIPOCALCULOMEDIA,
	   FOLHA.COMPETENCIAMES,
	   FOLHA.COMPETENCIAANO,
	   MOV.QTDEREFERENCIAINFORMADA,
	   MOV.QTDEREFERENCIACALCULADA,
	   MOV.VALORCALCULADO,
	   MOV.VALORINFORMADO,
	   FLH_MOVIMENTOFILIAL.IDPESSOAEMPRESA,
	   FLH_MOVIMENTOFILIAL.DATAFIM
 FROM NG_FOLHA.DBO.FLH_FOLHAPAYVERBA MOV
 INNER JOIN NG_FOLHA.DBO.FLH_VERBA RUB ON (MOV.IDVERBA = RUB.IDVERBA)
 INNER JOIN NG_FOLHA.DBO.FLH_FOLHAPAY FOLHA ON (MOV.IDPAY = FOLHA.IDPAY)
 INNER JOIN NG_FOLHA.DBO.FLH_REGISTRO EMP ON (EMP.IDREGISTRO = FOLHA.IDREGISTRO)
 INNER JOIN NG_FOLHA.DBO.FLH_SINDICATOMEDIAFERIAS SIND ON (RUB.IDVERBA = SIND.IDVERBA)
 LEFT JOIN NG_FOLHA.DBO.FLH_MOVIMENTOFILIAL
	ON EMP.IDOWNER = (SELECT FLH_REGISTRO.IDOWNER FROM NG_FOLHA.DBO.FLH_REGISTRO WHERE FLH_REGISTRO.IDREGISTRO = FLH_MOVIMENTOFILIAL.IDREGISTRO)
	AND EMP.CODIGOREGISTRO = (SELECT FLH_REGISTRO.CODIGOREGISTRO FROM NG_FOLHA.DBO.FLH_REGISTRO WHERE FLH_REGISTRO.IDREGISTRO = FLH_MOVIMENTOFILIAL.IDREGISTRO)
WHERE YEAR(GETDATE()) - 3 < FOLHA.COMPETENCIAANO

UNION

/* MEDIAS 13 SALARIO */
SELECT DISTINCT EMP.IDOWNER,
       EMP.CODIGOREGISTRO,
	   RUB.CODIGOVERBA, 
	   RUB.DESCRICAOVERBA,
	   SIND.IDTIPOCALCULOMEDIA,
	   FOLHA.COMPETENCIAMES,
	   FOLHA.COMPETENCIAANO,
	   MOV.QTDEREFERENCIAINFORMADA,
	   MOV.QTDEREFERENCIACALCULADA,
	   MOV.VALORCALCULADO,
	   MOV.VALORINFORMADO,
	   FLH_MOVIMENTOFILIAL.IDPESSOAEMPRESA,
	   FLH_MOVIMENTOFILIAL.DATAFIM
 FROM NG_FOLHA.DBO.FLH_FOLHAPAYVERBA MOV
 INNER JOIN NG_FOLHA.DBO.FLH_VERBA RUB ON (MOV.IDVERBA = RUB.IDVERBA)
 INNER JOIN NG_FOLHA.DBO.FLH_FOLHAPAY FOLHA ON (MOV.IDPAY = FOLHA.IDPAY)
 INNER JOIN NG_FOLHA.DBO.FLH_REGISTRO EMP ON (EMP.IDREGISTRO = FOLHA.IDREGISTRO)
 INNER JOIN NG_FOLHA.DBO.FLH_SINDICATOMEDIA13SALARIO SIND ON (RUB.IDVERBA = SIND.IDVERBA)
 LEFT JOIN NG_FOLHA.DBO.FLH_MOVIMENTOFILIAL
	ON EMP.IDOWNER = (SELECT FLH_REGISTRO.IDOWNER FROM NG_FOLHA.DBO.FLH_REGISTRO WHERE FLH_REGISTRO.IDREGISTRO = FLH_MOVIMENTOFILIAL.IDREGISTRO)
	AND EMP.CODIGOREGISTRO = (SELECT FLH_REGISTRO.CODIGOREGISTRO FROM NG_FOLHA.DBO.FLH_REGISTRO WHERE FLH_REGISTRO.IDREGISTRO = FLH_MOVIMENTOFILIAL.IDREGISTRO)
WHERE YEAR(GETDATE()) - 3 < FOLHA.COMPETENCIAANO
ORDER BY EMP.IDOWNER, EMP.CODIGOREGISTRO, FOLHA.COMPETENCIAMES, FOLHA.COMPETENCIAANO, RUB.CODIGOVERBA