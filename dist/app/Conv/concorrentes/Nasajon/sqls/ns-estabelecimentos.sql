select 
CASE
	WHEN estab.raizcnpj = emp.raizcnpj AND estab.ordemcnpj = emp.ordemcnpj THEN 1
	WHEN estab.raizcnpj = emp.raizcnpj AND estab.ordemcnpj != emp.ordemcnpj THEN 2
	WHEN estab.raizcnpj != emp.raizcnpj THEN 3
	WHEN estab.cpf = emp.cpf THEN 1
END indicador,
estab.codigo,
estab.descricao,
estab.tipoidentificacao,
estab.raizcnpj,
estab.ordemcnpj,
estab.cpf,
estab.caepf,
estab.cidade,
estab.inscricaoestadual,
estab.inscricaomunicipal,
estab.nomefantasia,
estab.email,
estab.site,
estab.tipologradouro,
estab.logradouro,
estab.numero,
estab.complemento,
estab.bairro,
estab.cep,
estab.tiposimples,
estab.dddtel,
estab.telefone,
estab.dddfax,
estab.fax,
estab.bloqueado,
estab.selecionarcfop,
estab.ramoatividade,
estab.qualificacao,
CASE
	WHEN estab.naturezapj is not null THEN estab.naturezapj
	ELSE CAST(emp.naturezajuridica AS INTEGER)
END naturezapj,
estab.anofiscal,
estab.inicio_atividades,
estab.final_atividades,
estab.dataregistro,
estab.suframa,
estab.atividademunicipal,
estab.atividadeestadual,
estab.registro,
estab.representante,
estab.cpfrepresentante,
estab.dddtelrepresentante,
estab.telefonerepresentante,
estab.ramalrepresentante,
estab.dddfaxrepresentante,
estab.faxrepresentante,
estab.emailrepresentante,
estab.caixapostal,
estab.ufcaixapostal,
estab.cepcaixapostal,
estab.fpas,
estab.acidentetrabalho,
estab.numeroproprietarios,
estab.numerofamiliares,
estab.numeroconta,
estab.tipopagamento,
estab.codigoterceiros,
estab.porte,
estab.fazpartepat,
estab.aliquotafilantropica,
estab.capitalsocial,
estab.pagapis,
estab.tipoconta,
estab.inicioexercicio,
estab.cei,
estab.datanascimentorepresentante,
estab.sexorepresentante,
estab.contacorrentepagadora,
estab.ibge,
estab.cnae,
estab.identificacaoregistro,
estab.agencia,
estab.contador,
estab.empresa,
estab.estabelecimento,
estab.contribuinteipi,
estab.sindicato,
estab.tipocontroleponto,
estab.centralizacontribuicaosindical,
estab.nomecontato,
estab.cpfcontato,
estab.telefonefixocontato,
estab.dddtelfixocontato,
estab.telefonecelularcontato,
estab.dddtelcelularcontato,
estab.faxcontato,
estab.dddfaxcontato,
estab.emailcontato,
estab.classificado,
estab.excessosublimite,
estab.aliquotaaplicavel,
estab.alelocodigopessoajuridica,
estab.alelonumerofilial,
estab.nisrepresentante,
estab.dataimplantacaosaldo,
estab.lastupdate,
estab.contribuinteicms,
estab.regraponto,
estab.id_centro_custo,
estab.centralizadorsefip,
estab.tipocaepf,
estab.indicatiocontratacaoaprendiz,
estab.processoaprendiz,
estab.aprendizcontratadoporintermedio,
estab.instituicaoeducativa,
estab.indicativocontratacaopcd,
estab.processocontratacaopcd,
estab.processofap,
estab.processorat,
estab.periodoapuracaopontoproprio,
estab.matriz,
estab.id_pessoa,
estab.importacao_hash,
estab.estabelecimento_multinota,
estab.codigoexterno,
estab.entidadeinscritapaa,
estab.tenant,
estab.desabilitado_persona,
estab.armazem,
estab.cafir,
estab.cafir_div,
estab.idtipoexploracao,
estab.participacao,
estab.inativo,
estab.hc_integracao_status,
estab.hc_lastupdate,
estab.data_inicial_nasajonhub,
estab.geo_localizacao,
estab.gestor,
estab.identificacaonasajongestor,
estab.isencaozfm,
 emp.raizcnpj raizcnpj_emp,
 emp.ordemcnpj ordemcnpj_emp
from ns.estabelecimentos estab inner join ns.empresas emp on (estab.empresa = emp.empresa)
order by 1, 2, 5, 6