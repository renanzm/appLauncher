SELECT CALCULOEVENTO.CODIGOEMPRESA,
       CALCULOEVENTO.CODIGOFUNCCONTR,
       CALCULOEVENTO.CODIGOEVENTO,
       CALCULOEVENTO.REFEREVENTO,
       CALCULOEVENTO.VALOREVENTO,
       EVENTOCALC.REFEREVENTO AS TIPOEVENTO,
       PERIODOCALCULO.COMPET
  FROM CALCULOEVENTO
 INNER JOIN EVENTO EVENTOCALC
    ON CALCULOEVENTO.CODIGOEVENTO = EVENTOCALC.CODIGOEVENTO
 INNER JOIN PERIODOCALCULO
    ON PERIODOCALCULO.CODIGOEMPRESA = CALCULOEVENTO.CODIGOEMPRESA
   AND PERIODOCALCULO.CODIGOPERCALCULO = CALCULOEVENTO.CODIGOPERCALCULO
 WHERE LEFT(PERIODOCALCULO.COMPET, 4) > LEFT(DATEADD(-3 YEAR TO CURRENT_DATE), 4)
   AND PERIODOCALCULO.CODIGOTIPOCALC <> 7
 ORDER BY 1, 2, 7, 3