SELECT DISTINCT
       fun_ser.CODIGOEMPRESA,
       fun_ser.EMPCONTRATAPRENDIZ,
       o.INSCRFEDERAL,
       o.NOMEOUTEMP,
       (SELECT MAX(fl.CODIGOESTAB)
           FROM FUNCLOCAL fl
          WHERE fl.CODIGOEMPRESA = fun_ser.CODIGOEMPRESA
            AND fl.CODIGOFUNCCONTR = fun_ser.CODIGOFUNCCONTR
            AND fl.DATATRANSF = (SELECT MAX(DATATRANSF)
                                   FROM FUNCLOCAL fl2
                                  WHERE fl2.CODIGOEMPRESA = fl.CODIGOEMPRESA
                                    AND fl2.CODIGOFUNCCONTR = fl.CODIGOFUNCCONTR)) AS "LOCAL",
       ou.CODIGOIMPOSTO,
       ou.CODIGOATIVFEDERAL,
       ou.CODIGOTABGPS,
       o.NUMEROFONE,
       o.DDDFONE,
       o.CODIGOTIPOLOGRAD,
       o.ENDEROUTEMP,
       o.NUMEROENDER,
       o.BAIRROOUTEMP,
       o.SIGLAESTADO,
       o.CEP,
       o.CODIGOMUNIC,
       m.NOMEMUNIC,
       m.CODIGORAIS
  FROM FUNCIONARIO fun_ser
  INNER JOIN OUTRAEMPEMP AS ou
    ON ou.CODIGOEMPRESA = fun_ser.CODIGOEMPRESA
   AND ou.CODIGOOUTEMP = fun_ser.EMPCONTRATAPRENDIZ
  INNER JOIN OUTRAEMPRESA AS o
    ON o.CODIGOOUTEMP = fun_ser.EMPCONTRATAPRENDIZ
  LEFT JOIN MUNICIPIO AS m
    ON m.CODIGOMUNIC = o.CODIGOMUNIC
   AND m.SIGLAESTADO = o.SIGLAESTADO
 ORDER BY fun_ser.CODIGOEMPRESA,
          fun_ser.EMPCONTRATAPRENDIZ