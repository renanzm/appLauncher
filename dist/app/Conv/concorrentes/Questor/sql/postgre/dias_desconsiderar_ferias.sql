WITH ULTIMO_SINDICATO AS (
    SELECT 
        FS.CODIGOEMPRESA,
        FS.CODIGOFUNCCONTR,
        FS.DATAINICIAL,
        FS.CODIGOSIND,
        RF.DATAINICIAL AS DATAFERIAS,
        ROW_NUMBER() OVER (
            PARTITION BY FS.CODIGOEMPRESA, FS.CODIGOFUNCCONTR, RF.DATAINICIAL
            ORDER BY FS.DATAINICIAL DESC
        ) AS ORDEM
    FROM FUNCSINDICATO FS
    JOIN RECIBOFERIAS RF
      ON RF.CODIGOEMPRESA   = FS.CODIGOEMPRESA
     AND RF.CODIGOFUNCCONTR = FS.CODIGOFUNCCONTR
     AND FS.DATAINICIAL <= RF.DATAINICIAL
)
SELECT DISTINCT
       US.CODIGOSIND,
       EXTRACT(DAY FROM RFD.DATA)   AS DIA,
       EXTRACT(MONTH FROM RFD.DATA) AS MES
FROM RECIBOFERIAS RF
INNER JOIN RECIBOFERIASDIASDESCON RFD
        ON RFD.CODIGOEMPRESA     = RF.CODIGOEMPRESA
       AND RFD.CODIGOFUNCCONTR   = RF.CODIGOFUNCCONTR
       AND RFD.DATAINICIAL       = RF.DATAINICIAL
       AND RFD.DATAINICIALFERIAS = RF.DATAINICIALFERIAS
INNER JOIN FUNCCONTRATO FC
        ON FC.CODIGOEMPRESA   = RF.CODIGOEMPRESA
       AND FC.CODIGOFUNCCONTR = RF.CODIGOFUNCCONTR
INNER JOIN ULTIMO_SINDICATO US
        ON US.CODIGOEMPRESA   = RF.CODIGOEMPRESA
       AND US.CODIGOFUNCCONTR = RF.CODIGOFUNCCONTR
       AND US.DATAFERIAS      = RF.DATAINICIAL
       AND US.ORDEM = 1 