 SELECT X.COD_EMP,
        X.COD_FUN,
        MIN(X.DATA_HAS) AS DATA_ANTIGA,
        X.COD_CCG
   FROM TB_CADHISTORICOSALARIAL_HAS X
  WHERE X.COD_CCG IS NOT NULL
    AND NOT EXISTS (SELECT 1
                      FROM TB_CADHISTORICOSALARIAL_HAS Y
                     WHERE Y.COD_EMP = X.COD_EMP
                       AND Y.COD_FUN = X.COD_FUN
                       AND Y.DATA_HAS < X.DATA_HAS
                       AND Y.COD_CCG <> X.COD_CCG)
  GROUP BY X.COD_EMP, X.COD_FUN, X.COD_CCG
  ORDER BY X.COD_EMP, X.COD_FUN, DATA_ANTIGA;