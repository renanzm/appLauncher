WITH CTE_FILIAL AS (
    SELECT
        TABFILIAL.*,
        ROW_NUMBER() OVER(PARTITION BY TABFILIAL.CNPJ ORDER BY TABFILIAL.CODIGO) AS RN
    FROM TABFILIAL
)
SELECT 
    CTE_FILIAL.*,
    TABEMPRESAS.CODIGOPAGAMENTOGPS,
    TABEMPRESAS.CODIGOFPAS,
    TABEMPRESAS.CODIGOTERCEIROS,
    TABEMPRESAS.ALIQUOTAFPAS,
    TABEMPRESAS.ALIQUOTATERCEIROS
FROM CTE_FILIAL
LEFT JOIN TABEMPRESAS ON TABEMPRESAS.CODIGO = CTE_FILIAL.CODIGOEMPRESA
ORDER BY CTE_FILIAL.CODIGOEMPRESA, CTE_FILIAL.CODIGO;