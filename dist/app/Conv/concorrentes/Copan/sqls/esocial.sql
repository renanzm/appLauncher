SELECT esoc.ID_CONTRIBUINTE AS COD_EMP,
	   cola.MATRICULA AS CODIGO,
	   cola.CODIGO_FUNCIONARIO,
	   cola.TP_FUNCIONARIO,
	   COALESCE(esoc.RECIBO, regi.RECIBO) AS RECIBO_PRODUCAO,
	   '' AS DESCRICAO,
	   '2200' AS EVENTO
FROM ESL_2200 AS esoc
LEFT JOIN ESL_REGISTRO regi
ON regi.ID_ESL_REGISTRO = esoc.ID_ESL_REGISTRO
INNER JOIN COLABORADOR AS cola
ON cola.ID_COLABORADOR = esoc.ID_COLABORADOR

UNION

SELECT esoc.ID_CONTRIBUINTE AS COD_EMP,
	   cola.MATRICULA AS CODIGO,
	   cola.CODIGO_FUNCIONARIO,
	   cola.TP_FUNCIONARIO,
	   COALESCE(esoc.RECIBO, regi.RECIBO) AS RECIBO_PRODUCAO,
	   '' AS DESCRICAO,
	   '2300' AS EVENTO
FROM ESL_2300 AS esoc
LEFT JOIN ESL_REGISTRO regi
ON regi.ID_ESL_REGISTRO = esoc.ID_ESL_REGISTRO
INNER JOIN COLABORADOR AS cola
ON cola.ID_COLABORADOR = esoc.ID_COLABORADOR

UNION

SELECT esoc. ID_CONTRIBUINTE AS COD_EMP,
	   '' AS CODIGO,
	   '' AS CODIGO_FUNCIONARIO,
	   '' AS TP_FUNCIONARIO,
	   COALESCE(esoc.RECIBO, regi.RECIBO) AS RECIBO_PRODUCAO,
	   '' AS DESCRICAO,
	   '1000' AS EVENTO
FROM ESL_1000 AS esoc
LEFT JOIN ESL_REGISTRO regi
ON regi.ID_ESL_REGISTRO = esoc.ID_ESL_REGISTRO

UNION

SELECT COD_EMP,
       CODIGO,
       '' as CODIGO_FUNCIONARIO,
       '' AS TP_FUNCIONARIO,
	   RECIBO_PRODUCAO,
	   DESCRICAO,
	   EVENTO
FROM ESOCIAL_REGISTRO
WHERE EVENTO = '1030'
   AND RECIBO_PRODUCAO <> ''
   AND LEFT(RECIBO_PRODUCAO,3) = '1.1'

ORDER BY 1, 7