WITH COLABORADOR_CONTRATO_ATUAL AS (
	SELECT SUB.ID_COLABORADOR,
	       MAX(SUB.DATA_ALTERACAO) AS DATA_ALTERACAO_ATUAL
	FROM COLABORADOR_CONTRATO AS SUB
	GROUP BY 1
)
SELECT DISTINCT
       func.COD_EMP,
       hor.COD_HORARIO,
       hor.DESCRICAO
FROM FUNCIONARIO AS func
LEFT JOIN COLABORADOR cola
  ON cola.ID_CONTRIBUINTE = func.COD_EMP
  AND cola.CODIGO_FUNCIONARIO = func.COD_FUN
  AND cola.TP_FUNCIONARIO = func.TIPO
LEFT JOIN COLABORADOR_CONTRATO_ATUAL colca
  ON colca.ID_COLABORADOR = cola.ID_COLABORADOR
LEFT JOIN COLABORADOR_CONTRATO colc
  ON colc.ID_COLABORADOR = cola.ID_COLABORADOR
  AND colca. DATA_ALTERACAO_ATUAL = colc.DATA_ALTERACAO
INNER JOIN HORARIO AS hor
	ON hor.COD_HORARIO = colc.ID_JORNADA
ORDER BY 1, 2