    SELECT distinct dbo.RHESOCIALEVENTOS2300.EMPRESA,
		   dbo.RHCONTRATOS.CONTRATO AS CODIGO,
           dbo.RHESOCIALEVENTOS2300.NRRECIBOESOCIAL,
		   coalesce(dbo.RHESOCIALEVENTOS2300.MATRICULAESOCIAL,STR(RHCONTRATOS.CONTRATO)) AS CODIGO_ESOCIAL,
		   dbo.RHESOCIALEVENTOS2300.TIPOEVENTOESOCIAL
      FROM dbo.RHESOCIALEVENTOS2300
LEFT OUTER JOIN dbo.RHPESSOAS ON dbo.RHESOCIALEVENTOS2300.CPF = dbo.RHPESSOAS.CPF
							 and RHESOCIALEVENTOS2300.EMPRESA = dbo.RHPESSOAS.EMPRESA
LEFT OUTER JOIN dbo.RHCONTRATOS ON  dbo.RHCONTRATOS.PESSOA = dbo.RHPESSOAS.PESSOA
                                   and dbo.RHCONTRATOS.EMPRESA = dbo.RHPESSOAS.EMPRESA
	 WHERE EVENTOESOCIAL = (select max(t2.EVENTOESOCIAL)
							 from dbo.RHESOCIALEVENTOS2300 as t2
							where t2.CPF = RHESOCIALEVENTOS2300.cpf
						      and t2.EMPRESA = RHESOCIALEVENTOS2300.EMPRESA
							  and t2.REGISTROEXCLUIDOESOCIAL = 0
							  and SITUACAOESOCIAL = 3
							  and NRRECIBOESOCIAL <> (''))
  ORDER BY 1, 2