/* CADA HORARIO POSSUI 4 LINHAS NA ABATHOR, REFERENTE A ENTRADA, SAIDA_INTERVALO, ENTRADA_INTERVALO, SAIDA
   SENDO ASSIM FOI FEITO UM SELECT POR FORA PARA TRAZER NA MESMA LINHA TODOS OS HORARIOS*/
SELECT CODCOLIGADA,
       CODHORARIO,
       INDICE,
       TIPO,
       MAX(CASE WHEN ORDEM = 1 THEN BATIDA END) AS ENTRADA,
       MAX(CASE WHEN ORDEM = 2 THEN BATIDA END) AS SAIDA_INTERVALO,
       MAX(CASE WHEN ORDEM = 3 THEN BATIDA END) AS ENTRADA_INTERVALO,
       MAX(CASE WHEN ORDEM = 4 THEN BATIDA END) AS SAIDA
FROM (
SELECT HOR.CODCOLIGADA,
	   HOR.CODHORARIO,
	   HOR.INDICE,
	   HOR.TIPO,
	   HOR.BATIDA,
	   ROW_NUMBER() OVER(PARTITION BY HOR.CODCOLIGADA, HOR.CODHORARIO, HOR.INDICE ORDER BY HOR.BATIDA) AS ORDEM
FROM ABATHOR HOR
WHERE HOR.TIPO NOT IN (4, 5)
) TD_DADOS
GROUP BY CODCOLIGADA, CODHORARIO, INDICE, TIPO;
