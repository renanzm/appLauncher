SELECT SEP.EMP_CODIGO,
	SEP.EPG_CODIGO,
	SEP.DATA,
	SEP.CAR_CODIGO,
	SEP.IND_CODIGO_SALARIO,
	SEP.SALCONTRATUAL,
	SEP.SALTIPO,
	CASE SEP.SALTIPO
    WHEN 'I' THEN COALESCE((
        SELECT VID.VALOR
          FROM VID
         WHERE VID.IND_CODIGO = SEP.IND_CODIGO_SALARIO
           AND VID.DATA = (SELECT MAX(V.DATA)
                             FROM VID V
                            WHERE V.IND_CODIGO = VID.IND_CODIGO
                              AND V.DATA <= SEP.DATA)), 0)
    WHEN 'C' THEN COALESCE((
        SELECT VID.VALOR
          FROM VID
         WHERE VID.IND_CODIGO = (SELECT FIRST 1 SCA.IND_CODIGO_SALARIO
                                     FROM SCA
                                    WHERE SCA.EMP_CODIGO = SEP.EMP_CODIGO
                                      AND SCA.CAR_CODIGO = SEP.CAR_CODIGO
                                      AND SCA.DATA <= SEP.DATA
                                    ORDER BY SCA.DATA DESC)
           AND VID.DATA = (SELECT MAX(V.DATA)
                             FROM VID V
                            WHERE V.IND_CODIGO = VID.IND_CODIGO
                              AND V.DATA <= SEP.DATA)), 0)
    ELSE SEP.VALOR
	END AS SALARIO,
	SEP.EST_CODIGO,
	SEP.HOR_CODIGO,
	SEP.LOT_CODIGO,
	SEP.SIN_CODIGO,
	SEP.TOM_CODIGO,
	SEP.EXPAGENOCIV,
	SEP.INDQTDE,
	SEP.HORASMES,
	SEP.HORASSEMANA,
	SEP.VALETRANSPORTEALIQ,
	SEP.TIPOPAGAMENTO,
	SEP.VALETRANSPORTE,
	SEP.DESCONTOVALE,
	SEP.HORARIOINTERVALO,
	SEP.OUTROSVINCULOS,
	SEP.REMUNEROUTROSVINCULOS,
	SEP.DESCOUTROSVINCULOS,
	SEP.VALEREFEICAO,
	SEP.VRF_TIPO,
	SEP.ADIANTAMENTO,
	SEP.PERCENTUALADIANT,
	SEP.BATEPONTO,
	SEP.MSL_ID,
	SEP.VALORADIANT,
	SEP.ADIANTTIPO,
	SEP.RH_SEP_ID,
	SEP.CES_CODIGO,
	SEP.IPS_ID,
	SEP.DSRPOROCORRENCIA,
	SEP.RETROATIVA,
	SEP.DTRETROATIVA,
	SEP.MSE_CODIGO,
	SEP.FUN_CODIGO,
	SEP.TIPOSALARIO,
	SEP.EXPAGENOCIV
FROM SEP
ORDER BY SEP.EMP_CODIGO, SEP.EPG_CODIGO, SEP.DATA