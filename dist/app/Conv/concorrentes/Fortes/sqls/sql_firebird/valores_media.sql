SELECT EFP.EMP_CODIGO,
       EFP.EFO_EPG_CODIGO,
       CAST(SUBSTRING(FPG.AnoMes FROM 1 FOR 4) || '-' || SUBSTRING(FPG.AnoMes FROM 5 FOR 2) || '-01' AS DATE) AS DTCALCULO,
       EFP.EVE_CODIGO,
       EFP.VALOR,
       EFP.REFERENCIA
  FROM EFP
  LEFT OUTER JOIN FPG
    ON FPG.EMP_CODIGO = EFP.EMP_CODIGO
   AND FPG.FOL_Seq = EFP.EFO_FOL_Seq
 WHERE FPG.AnoMes IS NOT NULL
   and (EFP.VALOR <> 0 or EFP.Referencia <> 0)
   AND LEFT(FPG.AnoMes, 4) > LEFT(DATEADD(-4 YEAR TO CURRENT_DATE), 4)
 ORDER BY EMP_CODIGO,
          DTCALCULO,
          EFO_EPG_CODIGO,
          EVE_CODIGO;