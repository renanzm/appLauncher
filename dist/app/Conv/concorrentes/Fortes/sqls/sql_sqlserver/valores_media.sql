SELECT EFP.EMP_CODIGO,
       EFP.EFO_EPG_CODIGO,
       CONVERT(DATE, CONCAT(SUBSTRING(FPG.AnoMes, 1, 4), '-', SUBSTRING(FPG.AnoMes, 5, 2), '-01')) AS DTCALCULO,
       EFP.EVE_CODIGO,
       EFP.VALOR,
       EFP.REFERENCIA
  FROM EFP
  LEFT OUTER JOIN FPG
    ON FPG.EMP_CODIGO = EFP.EMP_CODIGO
   AND FPG.FOL_Seq = EFP.EFO_FOL_Seq
 WHERE FPG.AnoMes IS NOT NULL
   and (EFP.VALOR <> 0 or EFP.Referencia <> 0)
   and LEFT(FPG.AnoMes, 4) > DATEADD(year, -4, GETDATE())
 ORDER BY EMP_CODIGO,
          DTCALCULO,
          EFO_EPG_CODIGO,
          EVE_CODIGO;