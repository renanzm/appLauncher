SELECT TS.BDCODEMP,
	   TS.BDCODSOC,
	   TS.BDCODCID,
	   TS.BDCGCCEISOC,
	   TS.BDENDSOC,
	   TS.BDNUMSOC,
	   TS.BDCOMPLSOC,
	   TS.BDBAISOC,
	   TS.BDCEPSOC,
	   TS.BDLOGRSOC,
	   TS.BDDATAENTSOC,
	   TS.BDDATASAISOC,
	   TS.BDESTCIVILSOC,
	   TS.BDRGSOC,
	   TS.BDDATANASCSOC,
	   TS.BDORGEMISOC,
	   TS.BDCODUFRG,
	   TS.BDCODCBO,
	   TS.BDCODCIDNASC,
	   TS.BDGRAUINST,
	   TS.BDSEXO,
	   TSR.*, 
	   TSC.BDPERCCOTA,
	   TSC.BDVALCOTA
FROM EMPRESAS_TSOC AS TS
INNER JOIN EMPRESAS_TSOC_REF AS TSR
ON TS.BDCODEMP = TSR.BDCODEMP AND 
   TS.BDCODSOC = TSR.BDCODSOC AND
   TSR.BDREFSOC = (SELECT MAX(EMPRESAS_TSOC_REF.BDREFSOC) FROM EMPRESAS_TSOC_REF WHERE EMPRESAS_TSOC_REF.BDCODEMP = TS.BDCODEMP AND EMPRESAS_TSOC_REF.BDCODSOC = TS.BDCODSOC)
LEFT JOIN EMPRESAS_TSOCCOTAS AS TSC
ON TS.BDCODEMP = TSC.BDCODEMP AND 
   TS.BDCODSOC = TSC.BDCODSOC AND
   TSC.BDREFCOTA = (SELECT MAX(EMPRESAS_TSOCCOTAS.BDREFCOTA) FROM EMPRESAS_TSOCCOTAS WHERE EMPRESAS_TSOCCOTAS.BDCODEMP = TS.BDCODEMP AND EMPRESAS_TSOCCOTAS.BDCODSOC = TS.BDCODSOC)
ORDER BY TS.BDCODEMP, TS.BDCODSOC
