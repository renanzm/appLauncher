WITH MAX_DATE AS (
	SELECT BDCODEMP, MAX(BDREFEMP) AS BDREFEMP
	FROM VRHF_BASE_TEMPCALC
	GROUP BY BDCODEMP
)
SELECT FOLHA.BDCODEMP,
       FOLHA.BDPAGEMP,
       FOLHA.BDPAGEMPCONTR
FROM VRHF_BASE_TEMPCALC AS FOLHA
INNER JOIN MAX_DATE
	ON MAX_DATE.BDCODEMP = FOLHA.BDCODEMP
	AND MAX_DATE.BDREFEMP = FOLHA.BDREFEMP
ORDER BY 1