SELECT TER.BDCODEMP,
       TER.BDREFEMP,
       TC.BDCODCENTRO,
       TC.BDCODTPCC,
       TC.BDNOMCTA,
       VRHTCUSTOM.BDCNPJTOM,
       VRH_BASE_TCUSTOM_END.BDREFCUSTO,
       VRH_BASE_TCUSTOM_END.BDCODCID,
       VRH_BASE_TCUSTOM_END.BDLOGRTOM,
       VRH_BASE_TCUSTOM_END.BDENDTOM,
       VRH_BASE_TCUSTOM_END.BDNUMCTOM,
       VRH_BASE_TCUSTOM_END.BDBAITOM,
       VRH_BASE_TCUSTOM_END.BDCEPTOM,
       VRH_BASE_TCUSTOM_END.BDDDDTOM,
       VRH_BASE_TCUSTOM_END.BDFONETOM,
       VRH_BASE_TCUSTOM_END.BDCOMPLTOM,
       VRH_BASE_TCUSTOM_GPS.BDCODCENTRO,
       VRH_BASE_TCUSTOM_GPS.BDCODTPCC,
       VRH_BASE_TCUSTOM_GPS.BDREFCUSTO,
       VRH_BASE_TCUSTOM_GPS.BDCODREC,
       VRH_BASE_TCUSTOM_GPS.BDCODCNAE,
       VRH_BASE_TCUSTOM_GPS.BDCODFPASTERC,
       VRH_BASE_TCUSTOM_GPS.BDEMPTOM,
       VRH_BASE_TCUSTOM_GPS.BDAUTTOM,
       VRH_BASE_TCUSTOM_GPS.BDCOLTOM,
       VRH_BASE_TCUSTOM_GPS.BDFAPTOM,
       VRH_BASE_TCUSTOM_GPS.BDCODRECTERC,
       VRH_BASE_TCUSTOM_GPS.BDRAT
FROM CENTROS_TPCC AS TC
INNER JOIN TEMPRESAS_REF AS TER
ON (TC.BDCODCENTRO = TER.BDCODCENTROS)
INNER JOIN VRH_BASE_TCUSTOM AS VRHTCUSTOM
ON (TC.BDCODCENTRO = VRHTCUSTOM.BDCODCENTRO AND TC.BDCODTPCC = VRHTCUSTOM.BDCODTPCC)
INNER JOIN VRH_BASE_TCUSTOM_END
ON (TC.BDCODCENTRO = VRH_BASE_TCUSTOM_END.BDCODCENTRO AND TC.BDCODTPCC = VRH_BASE_TCUSTOM_END.BDCODTPCC)
INNER JOIN VRH_BASE_TCUSTOM_GPS
ON (TC.BDCODCENTRO = VRH_BASE_TCUSTOM_GPS.BDCODCENTRO AND TC.BDCODTPCC = VRH_BASE_TCUSTOM_GPS.BDCODTPCC)
WHERE TER.BDREFEMP = (SELECT MAX(TEMPRESAS_REF.BDREFEMP) 
                        FROM TEMPRESAS_REF 
                       WHERE TEMPRESAS_REF.BDCODCENTROS = TC.BDCODCENTRO
                         AND TER.BDCODEMP = TEMPRESAS_REF.BDCODEMP)
AND VRH_BASE_TCUSTOM_END.BDREFCUSTO = (SELECT MAX(V.BDREFCUSTO) 
                                       FROM VRH_BASE_TCUSTOM_END AS V 
                                       WHERE V.BDCODCENTRO = TC.BDCODCENTRO 
                                       AND V.BDCODTPCC = TC.BDCODTPCC
                                       AND V.BDCODTPCC = VRH_BASE_TCUSTOM_END.BDCODTPCC)
AND VRH_BASE_TCUSTOM_GPS.BDREFCUSTO = (SELECT MAX(V.BDREFCUSTO) 
                                       FROM VRH_BASE_TCUSTOM_GPS AS V
                                       WHERE V.BDCODCENTRO = TC.BDCODCENTRO 
                                       AND V.BDCODTPCC = TC.BDCODTPCC
                                       AND V.BDCODTPCC = VRH_BASE_TCUSTOM_GPS.BDCODTPCC)
AND EXISTS(SELECT 1
             FROM VRHF_EMP_TPREPFN
            WHERE VRHF_EMP_TPREPFN.BDCODEMP = TER.BDCODEMP 
              AND VRHF_EMP_TPREPFN.BDCODTPCC = TC.BDCODTPCC)
ORDER BY TER.BDCODEMP, TC.BDCODCENTRO, TC.BDCODTPCC