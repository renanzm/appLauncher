SELECT VRHF_BASE_TEMPVINC.BDCODEMP,
       VRH_BASE_TQH_DIAS.BDCODPQUA,
       VRH_BASE_TQH_DIAS.BDCODQH,
       VRH_BASE_TQH_DIAS.BDCODQHH,
       VRH_BASE_TQH_DIAS.BDDIASEMQH,
	   VRH_BASE_TQH_HORARIO.BDHORFLEXIVEL,
	   VRH_BASE_TQH_HORARIO.BDINTERVARIAVEL,
	   VRH_BASE_TQH_DIAS.BDDSR,
	   VRH_BASE_TQH_DIAS.BDTIPODSR
FROM VRH_BASE_TQH_DIAS
INNER JOIN VRH_BASE_TQH_HORARIO
ON (VRH_BASE_TQH_DIAS.BDCODQHH = VRH_BASE_TQH_HORARIO.BDCODQHH)
INNER JOIN VRHF_BASE_TEMPVINC
ON (VRH_BASE_TQH_DIAS.BDCODPQUA = VRHF_BASE_TEMPVINC.BDCODPQUA)
WHERE VRHF_BASE_TEMPVINC.BDREFEMP = (SELECT MAX(T.BDREFEMP)
                                       FROM VRHF_BASE_TEMPVINC as T
                                      WHERE VRHF_BASE_TEMPVINC.BDCODPQUA = T.BDCODPQUA
                                        AND VRHF_BASE_TEMPVINC.BDCODEMP = T.BDCODEMP)
and exists(SELECT 1
             FROM VRH_EMP_TCOL_VINCDIA
            where VRH_EMP_TCOL_VINCDIA.BDCODEMP = VRHF_BASE_TEMPVINC.BDCODEMP
              and VRH_EMP_TCOL_VINCDIA.BDCODPQUA = VRH_BASE_TQH_DIAS.BDCODPQUA
              and VRH_EMP_TCOL_VINCDIA.BDCODQH = VRH_BASE_TQH_DIAS.BDCODQH)
ORDER BY VRHF_BASE_TEMPVINC.BDCODEMP, BDCODPQUA, BDCODQH, BDCODQHH, BDDIASEMQH