WITH PRIMEIRO_LANCAMENTO AS (SELECT CD_EMPRESA,
       CD_EMPREGADO,
       MIN(DT_INICIAL) AS DT_INICIAL,
       CD_CENTRO,
       CD_CENTROANT,
       CD_NEGOCIO,
       CD_NEGOCIOANT
  FROM HISTORICOPOSICAO
 WHERE CD_CENTROANT IS NOT NULL
 GROUP BY 1, 2, 4, 5, 6, 7
 ORDER BY 1, 2, 3)
SELECT PRIMEIRO_LANCAMENTO.CD_EMPRESA,
       PRIMEIRO_LANCAMENTO.CD_EMPREGADO,
       EMPREGADO.DT_ADMISSAO AS DT_INICIAL,
       CASE
        WHEN PRIMEIRO_LANCAMENTO.DT_INICIAL = EMPREGADO.DT_ADMISSAO THEN PRIMEIRO_LANCAMENTO.CD_CENTRO
        ELSE PRIMEIRO_LANCAMENTO.CD_CENTROANT
       END AS CD_CENTRO,
       CASE
        WHEN PRIMEIRO_LANCAMENTO.DT_INICIAL = EMPREGADO.DT_ADMISSAO THEN PRIMEIRO_LANCAMENTO.CD_NEGOCIO
        ELSE PRIMEIRO_LANCAMENTO.CD_NEGOCIOANT
       END AS CD_NEGOCIO
  FROM PRIMEIRO_LANCAMENTO
  LEFT JOIN EMPREGADO
    ON EMPREGADO.CD_EMPRESA = PRIMEIRO_LANCAMENTO.CD_EMPRESA
   AND EMPREGADO.CD_EMPREGADO = PRIMEIRO_LANCAMENTO.CD_EMPREGADO
UNION
SELECT CD_EMPRESA,
       CD_EMPREGADO,
       DT_INICIAL,
       CD_CENTRO,
       CD_NEGOCIO
  FROM HISTORICOPOSICAO
 WHERE CD_CENTRO IS NOT NULL
 ORDER BY 1, 2, 3;