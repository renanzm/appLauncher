SELECT CD_EMPRESA,
       COALESCE( (SELECT MAX(T.CD_TOMADOR)
	                FROM EMPREGADOTOMADOR AS T 
				   WHERE T.CD_EMPRESA = EMPREGADO.CD_EMPRESA
		             AND T.CD_EMPREGADO = EMPREGADO.CD_EMPREGADO) ,CD_FILIAL) as CD_FILIAL,
       CD_EMPREGADO,
       NR_CPF,
       NM_EMPREGADO,
       CD_ESTADOCIVIL,
       COALESCE ((SELECT h.CD_HORARIO
                    FROM HISTORICOHORARIO h
                   WHERE h.CD_EMPRESA = EMPREGADO.CD_EMPRESA
                     AND h.CD_EMPREGADO = EMPREGADO.CD_EMPREGADO
                     AND h.DT_ALTERACAO = (SELECT MIN(hist.DT_ALTERACAO)
                                             FROM HISTORICOHORARIO hist
                                            WHERE hist.CD_EMPRESA = h.CD_EMPRESA
                                              AND hist.CD_EMPREGADO = h.CD_EMPREGADO)), CD_HORARIO) AS CD_HORARIO,
       CD_DEPARTAMENTO,
       CD_SINDI,
       (SELECT t.DS_TABLOGRADOURO
          FROM TABLOGRADOURO t
         WHERE t.CD_TABLOGRADOURO = EMPREGADO.CD_TABLOGRADOURO) || ' ' || DS_ENDERECO AS DS_ENDERECO,
       CD_CENTRO,
       NR_CEP,
       NR_ENDERECO,
       DS_BAIRRO,
       DS_COMPLEMENTO,
       (SELECT MUNICIPIO.CD_MUNICIPIOIBGE
	      FROM MUNICIPIO
		 WHERE MUNICIPIO.CD_MUNICIPIO = EMPREGADO.CD_MUNICIPIO) AS MUNICIPIO_ENDERECO_IBGE,
       (SELECT SG_ESTADO
	      FROM ESTADO
		 WHERE ESTADO.CD_ESTADO = (SELECT CD_ESTADO
		                             FROM MUNICIPIO
									WHERE MUNICIPIO.CD_MUNICIPIO = EMPREGADO.CD_MUNICIPIO)) AS ESTADO,
       NR_TELEFONE,
       NR_CELULAR,
       TP_SEXO,
       DT_NASCIMENTO,
       DS_LOCALNASCIMENTO,
       CD_GRAUINST,
       DT_ADMISSAO,
       DS_NOMECONJUGE,
       NM_PAI,
       NM_MAE,
       NR_REGISTROGERAL,
       (SELECT SG_ESTADO
	      FROM ESTADO
		 WHERE ESTADO.CD_ESTADO = EMPREGADO.CD_ESTADORG) AS UF_RG,
       SG_ORGAOEXPRG,
       DT_EXPRG,
       NR_TITULOELEITOR,
       DS_ZONAELEITORAL,
       DS_SECAOELEITORAL,
       NR_CARTEIRAHABILIT,
       DS_CATEGORIA,
       NR_CTPS,
       NR_SERIECTPS,
       (SELECT SG_ESTADO
	      FROM ESTADO
		 WHERE ESTADO.CD_ESTADO = EMPREGADO.CD_ESTADOCTPS) AS UF_CTPS,
       NR_CARTEIRARESERV,
       DS_CATEGRESERV,
       DT_OPCAOFGTS,
       NR_PISPASEP,
       DT_CADASTROPIS,
       NR_HORASSEMANAL,
       NR_HORASMENSAL,
       DT_EXPCTPS,
       CD_COREMPREG,
       DT_DESLIGAMENTO,
       (SELECT c.CD_LEGAL
          FROM CATEGGFIP c
         WHERE c.CD_CATEGGFIP = EMPREGADO.CD_CATEGGFIP) AS CATEGORIA,
       VL_REMUNERACAO,
       (SELECT MAX(HISTORICOSALARIO.VL_SALARIOANTERIOR)
	      FROM HISTORICOSALARIO
		 WHERE HISTORICOSALARIO.CD_EMPRESA = EMPREGADO.CD_EMPRESA
		   AND HISTORICOSALARIO.CD_EMPREGADO = EMPREGADO.CD_EMPREGADO
		   AND HISTORICOSALARIO.VL_SALARIOANTERIOR = (SELECT MIN(AUX.VL_SALARIOANTERIOR)
		                                                FROM HISTORICOSALARIO AS AUX
													   WHERE HISTORICOSALARIO.CD_EMPRESA = AUX.CD_EMPRESA
													     AND HISTORICOSALARIO.CD_EMPREGADO = AUX.CD_EMPREGADO)) AS SALARIO_TROCA,
       CD_FUNCAO,
       (SELECT MAX(HISTORICOSALARIO.CD_FUNCAOANTERIOR)
	      FROM HISTORICOSALARIO
		 WHERE HISTORICOSALARIO.CD_EMPRESA = EMPREGADO.CD_EMPRESA
		   AND HISTORICOSALARIO.CD_EMPREGADO = EMPREGADO.CD_EMPREGADO
		   AND HISTORICOSALARIO.CD_FUNCAOANTERIOR = (SELECT MIN(AUX.CD_FUNCAOANTERIOR)
		                                               FROM HISTORICOSALARIO AS AUX
													  WHERE HISTORICOSALARIO.CD_EMPRESA = AUX.CD_EMPRESA
													    AND HISTORICOSALARIO.CD_EMPREGADO = AUX.CD_EMPREGADO)) AS CARGO_TROCA,
       CD_NEGOCIO,
       (SELECT MAX(HISTORICOFERIAS.DT_FIMAQUISITIVO)
	      FROM HISTORICOFERIAS
		 WHERE HISTORICOFERIAS.CD_EMPRESA = EMPREGADO.CD_EMPRESA
		   AND HISTORICOFERIAS.CD_EMPREGADO = EMPREGADO.CD_EMPREGADO) AS FIM_AQUISITIVO,
       CD_BANCORECPAG,
       CD_AGENCIARECPAG,
       NR_CONTARECPAG,
       NR_DIGITORECPAG,
       CD_MUNICIPIONASCIMENTO,
       DS_EMAIL,
       TP_CONTA,
       NR_DIGITOSERIECTPS,
       CD_BANCOPGTOPIS,
       CD_AGENCIAPGTOPIS,
       (SELECT MAX(CD_LEGALESOCIAL)
	      FROM TABCATEGTRAB
		 WHERE TABCATEGTRAB.CD_TABCATEGTRAB = EMPREGADO.CD_TABCATEGTRAB) AS CATEGORIA_ESOCIAL,
	   (SELECT MUNICIPIO.CD_MUNICIPIOIBGE
	      FROM MUNICIPIO
		 WHERE MUNICIPIO.CD_MUNICIPIO = EMPREGADO.CD_MUNICIPIONASCIMENTO) AS MUNICIPIO_NASCIMENTO_IBGE,
	   (SELECT SG_ESTADO
	      FROM ESTADO
		 WHERE ESTADO.CD_ESTADO = (SELECT CD_ESTADO
		                             FROM MUNICIPIO
									WHERE MUNICIPIO.CD_MUNICIPIO = EMPREGADO.CD_MUNICIPIONASCIMENTO)) AS ESTADONASCIMENTO,
	   DT_PRIMEIRAHABIL,
	   DT_EXPEDICAOCNH,
	   DT_VENCTOCNH,
       DS_ORGAOEMISSORCNH,
       (SELECT SG_ESTADO
	      FROM ESTADO
		 WHERE ESTADO.CD_ESTADO = EMPREGADO.CD_ESTADOCNH) AS UF_CNH,
       CD_PAISNACIONALIDADE,
       CD_TABLOGRADOURO,
	   NR_CNPJEMPREGADORANT,
	   TP_INSCRICAOEMPREGADORANT,
	   NR_MATRICULAANT,
	   TRANSFEMPC.DT_TRANSFEMPC,
	   TRANSFEMPC.TP_TRANSFERENCIA,
	   CD_SALCONT,
	   CD_INSTITUICAOTITULO,
	   CD_FLPEMPRESAESTAGIO,	   
	   TP_NIVELESTAGIO,
	   TP_NATUREZAESTAGIO,
	   DS_ESTAGIOAPOLICESEGURO,
	   CD_COREMPREG,
     CD_MATRICULA
  FROM EMPREGADO
  LEFT JOIN TRANSFEMPI 
  ON EMPREGADO.CD_EMPRESA = TRANSFEMPI.CD_EMPRESADEST 
  AND EMPREGADO.CD_EMPREGADO = TRANSFEMPI.CD_EMPREGADODEST
  LEFT JOIN TRANSFEMPC
  ON TRANSFEMPI.CD_TRANSFEMPC = TRANSFEMPC.CD_TRANSFEMPC
 ORDER BY CD_EMPRESA, CD_EMPREGADO