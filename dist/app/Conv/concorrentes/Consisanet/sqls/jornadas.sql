SELECT DISTINCT
       emp.CD_EMPRESA,
       jor.CD_HORARIO,
       jor.DS_HORARIO,
       jor.DT_CADASTRO,
       jor.TP_JORNADATRABALHO,
       (SELECT COUNT(DISTINCT jorhor.CD_HORARIODC)
          FROM HORARIOI jorhor
         WHERE jorhor.CD_HORARIO = jor.CD_HORARIO
           AND jorhor.NR_DIASEMANA IN (2, 3, 4, 5, 6)) AS TIPO
  FROM EMPREGADO emp
  LEFT JOIN HISTORICOHORARIO his
    ON his.CD_EMPRESA = emp.CD_EMPRESA
   AND his.CD_EMPREGADO = emp.CD_EMPREGADO
 INNER JOIN HORARIOC jor
    ON jor.CD_HORARIO IN (his.CD_HORARIOANTERIOR, his.CD_HORARIO)
    OR jor.CD_HORARIO IN (emp.CD_HORARIO)
 ORDER BY CD_EMPRESA, CD_HORARIO;