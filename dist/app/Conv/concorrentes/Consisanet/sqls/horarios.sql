SELECT DISTINCT
       emp.CD_EMPRESA,
       jorhor.CD_HORARIODC,
       (SELECT hor.DS_HORARIODC
          FROM HORARIODC hor
         WHERE hor.CD_HORARIODC = jorhor.CD_HORARIODC) AS DS_HORARIODC,
       (SELECT hor.DT_CADASTRO
          FROM HORARIODC hor
         WHERE hor.CD_HORARIODC = jorhor.CD_HORARIODC) AS DT_CADASTRO,
       (SELECT MAX(h.HR_INICIO)
          FROM HORARIODI h
         WHERE h.CD_HORARIODC = jorhor.CD_HORARIODC
           AND h.CD_HORARIODI = 1
           AND h.TP_HORARIO = 'T') AS ENTRADA,
       (SELECT MAX(h.HR_FIM)
          FROM HORARIODI h
          WHERE h.CD_HORARIODC = jorhor.CD_HORARIODC
            AND h.CD_HORARIODI = 1) AS SAIDA_INTERVALO,
       (SELECT MAX(h.HR_INICIO)
          FROM HORARIODI h
         WHERE h.CD_HORARIODC = jorhor.CD_HORARIODC
           AND h.CD_HORARIODI = 2) AS ENTRADA_INTERVALO,
       (SELECT MAX(h.HR_FIM)
          FROM HORARIODI h
         WHERE h.CD_HORARIODC = jorhor.CD_HORARIODC
           AND h.CD_HORARIODI = 2
           AND h.TP_HORARIO = 'T') AS SAIDA
  FROM EMPREGADO emp
  LEFT JOIN HISTORICOHORARIO his
    ON his.CD_EMPRESA = emp.CD_EMPRESA
   AND his.CD_EMPREGADO = emp.CD_EMPREGADO
  LEFT JOIN HORARIOI jorhor
    ON jorhor.CD_HORARIO IN (his.CD_HORARIOANTERIOR, his.CD_HORARIO)
    OR jorhor.CD_HORARIO IN (emp.CD_HORARIO)
 WHERE jorhor.CD_HORARIODC IS NOT NULL
 ORDER BY CD_EMPRESA, CD_HORARIODC;