SELECT CD_EMPRESA,
       CD_EMPREGADO,
       DT_ALTERACAO,
       CD_FUNCAO
  FROM HISTORICOSALARIO
  WHERE CD_FUNCAO != COALESCE(( SELECT MAX(C2.CD_FUNCAO) 
								 FROM HISTORICOSALARIO AS C2 
							    WHERE C2.CD_EMPRESA = HISTORICOSALARIO.CD_EMPRESA
								  AND C2.CD_EMPREGADO = HISTORICOSALARIO.CD_EMPREGADO
								  AND C2.DT_ALTERACAO =  ( SELECT MAX(C2.DT_ALTERACAO) 
															 FROM HISTORICOSALARIO AS C2 
														    WHERE C2.CD_EMPRESA = HISTORICOSALARIO.CD_EMPRESA
															  AND C2.CD_EMPREGADO = HISTORICOSALARIO.CD_EMPREGADO
															  AND C2.DT_ALTERACAO < HISTORICOSALARIO.DT_ALTERACAO ) ), 0)
 ORDER BY 1, 2, 3;