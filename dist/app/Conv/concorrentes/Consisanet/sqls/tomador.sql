SELECT DISTINCT EMPTOM.CD_EMPRESA,
       T.*,
	   (SELECT m.CD_MUNICIPIOIBGE
	      FROM MUNICIPIO m
	     WHERE m.CD_MUNICIPIO = T.CD_MUNICIPIO) AS MUNICIPIO_IBGE,
		(SELECT MAX(DISTINCT pg.CD_LEGAL)
           FROM CODPGTOGPS pg
          WHERE pg.CD_PGTOGPS = T.CD_PGTOGPS) AS CODIGO_GPS,
        (SELECT MAX(lot.CD_LOTACAO)
           FROM LOTACAOTRIBUTARIA lot
          WHERE lot.CD_EMPRESA = EMPTOM.CD_EMPRESA
            AND lot.CD_TOMADOR = EMPTOM.CD_TOMADOR) AS CODIGO_ESOCIAL
  FROM EMPREGADOTOMADOR AS EMPTOM LEFT OUTER JOIN TOMADOR AS T
       ON EMPTOM.CD_TOMADOR = T.CD_TOMADOR 
 ORDER BY 1,2