SELECT DISTINCT hs.CD_EMPRESA,
       hs.CD_FUNCAO,
       fun.DS_FUNCAO,
                (SELECT MAX(CD_CODBRASOPER)
                   FROM PROFISSAO2002
                  WHERE PROFISSAO2002.CD_PROFISSAO2002 = fun.CD_PROFISSAO2002) AS CD_PROFISSAO,
                (SELECT MAX(CD_CODBRASOPER)
                   FROM PROFISSAO
                  WHERE PROFISSAO. CD_PROFISSAO = fun.CD_PROFISSAO) AS CD_PROFISSAO2002
  FROM HISTORICOSALARIO hs
  LEFT JOIN FUNCAO fun
    ON fun.CD_FUNCAO = hs.CD_FUNCAO
    
UNION ALL
   
SELECT DISTINCT emp.CD_EMPRESA,
       emp.CD_FUNCAO,
       fun.DS_FUNCAO,
                (SELECT MAX(CD_CODBRASOPER)
                   FROM PROFISSAO2002
                  WHERE PROFISSAO2002.CD_PROFISSAO2002 = fun.CD_PROFISSAO2002) AS CD_PROFISSAO,
                (SELECT MAX(CD_CODBRASOPER)
                   FROM PROFISSAO
                  WHERE PROFISSAO. CD_PROFISSAO = fun.CD_PROFISSAO) AS CD_PROFISSAO2002
  FROM EMPREGADO emp
  LEFT JOIN FUNCAO fun
    ON fun.CD_FUNCAO = emp.CD_FUNCAO
   WHERE NOT EXISTS ( SELECT 1 FROM HISTORICOSALARIO hs2 WHERE emp.CD_EMPRESA = hs2.CD_EMPRESA AND emp.CD_FUNCAO = hs2.CD_FUNCAO)

UNION ALL

SELECT DISTINCT autemp.CD_EMPRESA,
       aut.CD_FUNCAO,
       fun.DS_FUNCAO,
       (SELECT MAX(CD_CODBRASOPER)
          FROM PROFISSAO2002
         WHERE PROFISSAO2002.CD_PROFISSAO2002 = fun.CD_PROFISSAO2002) AS CD_PROFISSAO,
       (SELECT MAX(CD_CODBRASOPER)
          FROM PROFISSAO
         WHERE PROFISSAO. CD_PROFISSAO = fun.CD_PROFISSAO) AS CD_PROFISSAO2002
  FROM (
       SELECT CD_EMPRESA,
              CD_FILIAL,
              CD_AUTONOMO,
              MIN(DT_LANCAMENTO) AS ADMISSAO
         FROM LANCAUTONOMO
        GROUP BY CD_EMPRESA, CD_FILIAL, CD_AUTONOMO
       ) autemp
  LEFT JOIN AUTONOMO aut
    ON aut.CD_AUTONOMO = autemp.CD_AUTONOMO
  LEFT JOIN FUNCAO fun
    ON fun.CD_FUNCAO = aut.CD_FUNCAO
 WHERE aut.CD_FUNCAO IS NOT NULL

ORDER BY 1, 2