SELECT (SELECT "G-EMPRESAS".CODIGO_EXTERNO FROM "G-EMPRESAS" WHERE "WP-PROCESSAMENTOS".EMPRESA_ID = "G-EMPRESAS".CODIGO) AS EMPRESA,
       (SELECT "WP-PESSOAL".CODIGO
		  FROM "WP-PESSOAL", 
		       "WP-PESSOAL_CONTRATOS"
		 WHERE "WP-PESSOAL_CONTRATOS".EMPRESA_ID = "WP-PESSOAL".EMPRESA_ID
		   AND "WP-PESSOAL_CONTRATOS".PESSOAL_ID = "WP-PESSOAL".PESSOAL_ID		
		   AND "WP-PROCESSAMENTOS".PESSOAL_CONTRATOS_ID = "WP-PESSOAL_CONTRATOS".PESSOAL_CONTRATOS_ID ) AS EMPREGADO,
       (SELECT MAX("WP-EVENTOS".CODIGO)
		  FROM "WP-EVENTOS",
		       "WP-EVENTOS_EMPRESAS"
		 WHERE "WP-EVENTOS".EVENTOS_ID = "WP-PROCESSAMENTOS".EVENTOS_ID
		   AND "WP-EVENTOS_EMPRESAS".EMPRESA_ID = "WP-PROCESSAMENTOS".EMPRESA_ID
		   AND "WP-EVENTOS".EVENTOS_ID = "WP-EVENTOS_EMPRESAS".EVENTOS_ID ) AS EVENTO,
		"WP-PROCESSAMENTOS"."COMPETENCIA",
		"WP-PROCESSAMENTOS".DATA_INICIO,
		"WP-PROCESSAMENTOS".VALOR_LANCADO,
		"WP-PROCESSAMENTOS".VALOR_CALCULADO
  FROM "WP-PROCESSAMENTOS"
  WHERE (SELECT MAX("WP-EVENTOS".CODIGO)
		  FROM "WP-EVENTOS",
		       "WP-EVENTOS_EMPRESAS"
		 WHERE "WP-EVENTOS".EVENTOS_ID = "WP-PROCESSAMENTOS".EVENTOS_ID
		   AND "WP-EVENTOS_EMPRESAS".EMPRESA_ID = "WP-PROCESSAMENTOS".EMPRESA_ID
		   AND "WP-EVENTOS".EVENTOS_ID = "WP-EVENTOS_EMPRESAS".EVENTOS_ID ) IS NOT NULL
     AND "WP-PROCESSAMENTOS".DATA_INICIO >= DATEADD(YEAR, -3, CURRENT_DATE)
  ORDER BY 1,2,4,3