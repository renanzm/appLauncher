SELECT "G-EMPRESAS".CODIGO_EXTERNO AS EMPRESA,
"WP-PESSOAL".CODIGO,
"WP-PESSOAL".NOME,
"WP-PESSOAL".BANCOS_ID,
"WP-PESSOAL".BANCOS_AGENCIAS_ID,
"WP-PESSOAL".BANCO_NRO_CONTA,
"WP-PESSOAL".BANCO_TIPO_CONTA,
"WP-PESSOAL".CTPS_NRO,
"WP-PESSOAL".CTPS_SERIE,
"WP-PESSOAL".CTPS_DIGITO,
"WP-PESSOAL".CTPS_UF,
"WP-PESSOAL".CTPS_EMISSAO,
"WP-PESSOAL".RG_NRO,
"WP-PESSOAL".RG_ORGAO_EXP,
"WP-PESSOAL".RG_DATA_EXP,
"WP-PESSOAL".RG_UF,
"WP-PESSOAL".CPF_NRO,
"WP-PESSOAL".PIS_NRO,
"WP-PESSOAL".PIS_DATA,
"WP-PESSOAL".PIS_TIPO,
"WP_PESSOAL_DOCUMENTOS".CNH_NRO,
"WP_PESSOAL_DOCUMENTOS".CNH_CATEGORIA,
"WP_PESSOAL_DOCUMENTOS".CNH_VALIDADE,
"WP_PESSOAL_DOCUMENTOS".CNH_EMISSAO,
"WP_PESSOAL_DOCUMENTOS".CNH_ORGAO_EMISSOR,
"WP_PESSOAL_DOCUMENTOS".CNH_UF,
"WP_PESSOAL_DOCUMENTOS".CNH_DATA_PRIMEIRA_HABILITACAO,
"WP-PESSOAL".TIT_ELEITOR_NRO,
"WP-PESSOAL".TIT_ELEITOR_ZONA,
"WP-PESSOAL".TIT_ELEITOR_SECAO,
"WP-PESSOAL".SEFIP_GRAU_INSTR,
"WP-PESSOAL".CHEGADA_NO_BRASIL,
"WP-PESSOAL".ESTADO_CIVIL,
"WP-PESSOAL".NASCIM_SEXO,
(SELECT "G-MUNICIPIOS".DESCRICAO FROM "G-MUNICIPIOS" WHERE "WP-PESSOAL".NASCIM_NATURALIDADE = "G-MUNICIPIOS".MUNICIPIOS_ID) AS LOCAL_NASCTO,
(SELECT "G-MUNICIPIOS".UF FROM "G-MUNICIPIOS" WHERE "WP-PESSOAL".NASCIM_NATURALIDADE = "G-MUNICIPIOS".MUNICIPIOS_ID) AS UF_NASCTO,
(SELECT "G-MUNICIPIOS".CODIGO_IBGE FROM "G-MUNICIPIOS" WHERE "WP-PESSOAL".NASCIM_NATURALIDADE = "G-MUNICIPIOS".MUNICIPIOS_ID) AS CODIGO_IBGE_NASCTO,
"WP-PESSOAL".NASCIM_DATA,
"WP-PESSOAL".NASCIM_RACA_COR,
"WP-PESSOAL".NOME_PAI,
"WP-PESSOAL".NOME_MAE,
"WP-PESSOAL".ENDER_TIPO_LOGRADOURO,
"WP-PESSOAL".ENDER_RUA,
"WP-PESSOAL".ENDER_NUMERO,
"WP-PESSOAL".ENDER_COMPLEMENTO,
"WP-PESSOAL".ENDER_BAIRRO,
"WP-PESSOAL".ENDER_CEP,
"WP-PESSOAL".ENDER_EMAIL,
(SELECT "G-MUNICIPIOS".DESCRICAO FROM "G-MUNICIPIOS" WHERE "WP-PESSOAL".ENDER_CIDADE = "G-MUNICIPIOS".MUNICIPIOS_ID) AS CIDADE,
(SELECT "G-MUNICIPIOS".UF FROM "G-MUNICIPIOS" WHERE "WP-PESSOAL".ENDER_CIDADE = "G-MUNICIPIOS".MUNICIPIOS_ID) AS ESTADO,
(SELECT "G-MUNICIPIOS".CODIGO_IBGE FROM "G-MUNICIPIOS" WHERE "WP-PESSOAL".ENDER_CIDADE = "G-MUNICIPIOS".MUNICIPIOS_ID) AS CODIGO_IBGE_ENDERECO,
"WP-PESSOAL".ENDER_FONE_RES,
"WP-PESSOAL".ENDER_FONE_CEL,
"WP-PESSOAL".TIPO_DEFICIENCIA,
"WP-PESSOAL".RAIS_SINDICALIZADO_SN,
"WP-PESSOAL".TIPO_SANGUINEO,
"WP-PESSOAL".RP_NRO,
"WP-PESSOAL".RP_ORGAO_EMISSOR,
"WP-PESSOAL".RP_EMISSAO,
"WP-PESSOAL".CERTIFICADO_MILITAR,
PESSOAL_CONTRATOS.ADMISSAO_DATA,
PESSOAL_CONTRATOS.RESCISAO_DATA,
PESSOAL_CONTRATOS.RAIS_VINCULO,
PESSOAL_CONTRATOS.RAIS_TIPO_ADMISAO,
PESSOAL_CONTRATOS.SEFIP_CATEGORIA,
PESSOAL_CONTRATOS.CTR_EXP_FIM,
PESSOAL_CONTRATOS.CTR_EXP_PROR_FIM,
PESSOAL_CONTRATOS.FGTS_DATA,
PESSOAL_CONTRATOS.NRO_CARTAO_PONTO,
PESSOAL_CONTRATOS.FGTS_CONTA,
"WP_PESSOAL_DOCUMENTOS".CERT_CIVIL_TIPO,
"WP_PESSOAL_DOCUMENTOS".CERT_CIVIL_DATA,
"WP_PESSOAL_DOCUMENTOS".CERT_CIVIL_MATRICULA,
"WP_PESSOAL_DOCUMENTOS".CERT_CIVIL_LIVRO,
"WP_PESSOAL_DOCUMENTOS".CERT_CIVIL_FOLHA,
"WP_PESSOAL_DOCUMENTOS".CERT_CIVIL_CARTORIO,
(SELECT "G-MUNICIPIOS".CODIGO_IBGE FROM "G-MUNICIPIOS" WHERE "WP_PESSOAL_DOCUMENTOS".CERT_CIVIL_MUNICIPIO_ID = "G-MUNICIPIOS".MUNICIPIOS_ID) AS CODIGO_IBGE_CERT_CIVIL,
"WP_PESSOAL_DOCUMENTOS".PASSAPORTE_NUMERO,
"WP_PESSOAL_DOCUMENTOS".PASSAPORTE_EMISSOR,
"WP_PESSOAL_DOCUMENTOS".PASSAPORTE_EMISSAO,
"WP_PESSOAL_DOCUMENTOS".PASSAPORTE_VALIDADE,
(SELECT "G-MUNICIPIOS".DESCRICAO FROM "G-MUNICIPIOS" WHERE "WP_PESSOAL_DOCUMENTOS".PASSAPORTE_MUNICIPIO_ID = "G-MUNICIPIOS".MUNICIPIOS_ID) AS LOCAL_PASSAPORTE,
(SELECT "G-PAISES".NOMEPAIS FROM "G-PAISES" WHERE "WP_PESSOAL_DOCUMENTOS".PASSAPORTE_PAIS_ID = "G-PAISES".CODIGOPAIS) AS PAIS_PASSAPORTE,
"WP_PESSOAL_DOCUMENTOS".PASSAPORTE_PAIS_ID,
"WP_PESSOAL_DOCUMENTOS".NATURALIZACAO_NUMERO,
"WP_PESSOAL_DOCUMENTOS".NATURALIZACAO_DATA,
"WP_PESSOAL_DOCUMENTOS".RIC_NUMERO,
"WP_PESSOAL_DOCUMENTOS".RIC_EMISSOR,
"WP_PESSOAL_DOCUMENTOS".RIC_DATA,
"WP_PESSOAL_DOCUMENTOS".RNE_NRO,
"WP_PESSOAL_DOCUMENTOS".RNE_EMISSAO,
"WP_PESSOAL_DOCUMENTOS".RNE_VALIDADE,
"WP_PESSOAL_DOCUMENTOS".RNE_ORGAO_EMISSOR,
(SELECT DATEADD(YEAR, 1, MAX("WP-PERIODOS_AQUISITIVOS".DATA_FIM))
    FROM "WP-PERIODOS_AQUISITIVOS"
    LEFT JOIN "WP-GOZO_FERIAS" ON "WP-GOZO_FERIAS".PERIODOS_AQUISITIVOS_ID = "WP-PERIODOS_AQUISITIVOS".PERIODOS_AQUISITIVOS_ID
    WHERE "WP-PERIODOS_AQUISITIVOS".PESSOAL_CONTRATOS_ID = PESSOAL_CONTRATOS.PESSOAL_CONTRATOS_ID
          AND "WP-GOZO_FERIAS".DATA_FIM IS NOT NULL) AS PERIODOAQUISITIVO,
PESSOAL_CONTRATOS.CATEGORIAS_TRABALHADORES_ID,
PESSOAL_CONTRATOS.ESTAGIO_NATUREZA,
PESSOAL_CONTRATOS.ESTAGIO_NIVEL,
PESSOAL_CONTRATOS.ESTAGIO_NUMERO_SEGURO,
PESSOAL_CONTRATOS.ESTAGIO_INSTITUICAOENSINO_ID,
PESSOAL_CONTRATOS.ESTAGIO_RESPONSAVEL_ID,
PESSOAL_CONTRATOS.ESTAGIO_AGENTEINTEGRACAO_ID,
PESSOAL_CONTRATOS.ESOCIAL_MATRICULA_ANTIGA,
(SELECT MAX("WP_JORNADAS".CARGAHORARIAMENSAL)
   FROM "WP_JORNADAS",
        "WP-PESSOAL_TEMPO"
  WHERE "WP-PESSOAL_TEMPO".JORNADAS_ID = "WP_JORNADAS".JORNADAS_ID
    AND "WP-PESSOAL_TEMPO".EMPRESA_ID = "WP_JORNADAS".EMPRESA_ID 
    AND "WP-PESSOAL".EMPRESA_ID = "WP_JORNADAS".EMPRESA_ID
	AND "WP-PESSOAL_TEMPO".PESSOAL_CONTRATOS_ID  = PESSOAL_CONTRATOS.PESSOAL_CONTRATOS_ID
    AND "WP-PESSOAL_TEMPO".DATA_TEMPO = (SELECT MAX(SUB.DATA_TEMPO)
                                           FROM "WP-PESSOAL_TEMPO" AS SUB
                                          WHERE "WP-PESSOAL_TEMPO".JORNADAS_ID = SUB.JORNADAS_ID
                                            AND "WP-PESSOAL_TEMPO".EMPRESA_ID = SUB.EMPRESA_ID 
											AND "WP-PESSOAL_TEMPO".PESSOAL_CONTRATOS_ID  = SUB.PESSOAL_CONTRATOS_ID)) AS HORAS_MES,
 (SELECT MAX("WP_JORNADAS".CARGAHORARIASEMANAL)
   FROM "WP_JORNADAS",
        "WP-PESSOAL_TEMPO"
  WHERE "WP-PESSOAL_TEMPO".JORNADAS_ID = "WP_JORNADAS".JORNADAS_ID
    AND "WP-PESSOAL_TEMPO".EMPRESA_ID = "WP_JORNADAS".EMPRESA_ID 
    AND "WP-PESSOAL".EMPRESA_ID = "WP_JORNADAS".EMPRESA_ID
	AND "WP-PESSOAL_TEMPO".PESSOAL_CONTRATOS_ID  = PESSOAL_CONTRATOS.PESSOAL_CONTRATOS_ID
    AND "WP-PESSOAL_TEMPO".DATA_TEMPO = (SELECT MAX(SUB.DATA_TEMPO)
                                           FROM "WP-PESSOAL_TEMPO" AS SUB
                                          WHERE "WP-PESSOAL_TEMPO".JORNADAS_ID = SUB.JORNADAS_ID
                                            AND "WP-PESSOAL_TEMPO".EMPRESA_ID = SUB.EMPRESA_ID
											AND "WP-PESSOAL_TEMPO".PESSOAL_CONTRATOS_ID  = SUB.PESSOAL_CONTRATOS_ID)) AS HORAS_SEMANA
FROM "WP-PESSOAL"
LEFT  JOIN "WP-PESSOAL_CONTRATOS" PESSOAL_CONTRATOS
	ON ("WP-PESSOAL".PESSOAL_ID = PESSOAL_CONTRATOS.PESSOAL_ID 
	AND "WP-PESSOAL".EMPRESA_ID = PESSOAL_CONTRATOS.EMPRESA_ID
	AND PESSOAL_CONTRATOS.ADMISSAO_DATA = (SELECT MAX(PESSOAL_CONTRATOS_SUB.ADMISSAO_DATA) 
										   FROM "WP-PESSOAL_CONTRATOS" PESSOAL_CONTRATOS_SUB
										   WHERE "WP-PESSOAL".PESSOAL_ID = PESSOAL_CONTRATOS_SUB.PESSOAL_ID
										   AND "WP-PESSOAL".EMPRESA_ID = PESSOAL_CONTRATOS_SUB.EMPRESA_ID))
LEFT  JOIN "WP_PESSOAL_DOCUMENTOS" 
	ON ("WP-PESSOAL".PESSOAL_ID = "WP_PESSOAL_DOCUMENTOS".PESSOAL_DOCUMENTOS_ID)
LEFT JOIN "G-EMPRESAS" ON ("WP-PESSOAL".EMPRESA_ID = "G-EMPRESAS".CODIGO)
ORDER BY EMPRESA, "WP-PESSOAL".CODIGO