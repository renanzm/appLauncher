WITH ULTIMA_VIGENCIA AS (
	SELECT CODEMP,
	       CODCAD,
	       MAX(ANOMES) AS ANOMES
    FROM PHCCAD2
    GROUP BY CODEMP, CODCAD
),
ULTIMO_CONJUGE AS (
	SELECT CODEMP,
	       CODCAD,
	       MAX(SEQUEN) AS SEQUEN
	FROM PHCCJG
	GROUP BY CODEMP, CODCAD
	ORDER BY 1, 2
)
SELECT PHCCAD.CODEMP,
	   PHCCAD.CODCAD,
	   PHCCAD.NOMCOM,
	   PHCCAD.DATADM,
	   PHCCAD.DATDEM,
	   PHCCAD.DATNAS,
	   PHCCAD.CODSEX,
	   PHCCAD.ESTCIV,
	   PHCCAD.CODRAC,
	   PHCCAD.CODINS,
	   PHCCAD.NATATI,
	   PHCCAD.TIPADM,
	   PHCCAD.DATOPC,
	   PHCCAD.TIPCON,
	   PHCCAD.TIPPAG,
	   PHCCAD.CONLIQ,
	   PHCCAD.BANLIQ,
	   PHCCAD.AGELIQ,
	   PHCCAD.PAGSIN,
       PHCDOC.NUMCPF,
       PHCDOC.NUMNIT,
       PHCDOC.NUMPIS,
       PHCDOC.NUMCAR,
       PHCDOC.SERCAR,
       PHCDOC.ESTCAR,
       PHCDOC.DATCAR,
       PHCDOC.NUMTIT,
       PHCDOC.ZONTIT,
       PHCDOC.SECTIT,
       PHCDOC.NUMIDE,
       PHCDOC.ORGIDE,
       PHCDOC.DATIDE,
       PHCDOC.SMLCER,
       PHCDOC.SMLCAT,
       PHCDOC.CARHAB,
       PHCDOC.DATHAB,
       PHCDOC.VCTHAB,
       PHCDOC.CATHAB,
       PHCDOC.PRIHAB,
       PHCDOC.ESTHAB,
       PHCDOC.NUMLIV,
       PHCDOC.NUMFOL,
       PHCDOC.TIPSAN,
       PHCDOC.NUMRIC,
       PHCDOC.ORGRIC,
       PHCDOC.CIDRIC,
       PHCDOC.DATRIC,
       PHCPIS.DATPIS,
       PHCPIS.BANPIS,
       PHCPIS.AGEPIS,
       PHCEND.TIPLOG,
       PHCEND.LOGRAD,
       PHCEND.COMPLE,
       PHCEND.NUMERO,
       PHCEND.BAIRRO,
       PHCEND.CIDADE,
       PHCEND.ESTADO,
       PHCEND.NUMCEP,
       PHCEND.CMPCEP,
       PHCEND.NUMDDD,
       PHCEND.TELEFO,
       PHCEND.E_MAIL,
       PHCEND.CODMUN,
       PHCEND.DDDCEL,
       PHCEND.NUMCEL,
       PHCNAT.CODNAC,
       PHCNAT.CIDADE AS LOCAL_NASCIMENTO,
       PHCNAT.ESTADO AS ESTADO_NASCIMENTO,
       PHCNAT.CODMUN AS COD_MUN_NASCIMENTO,
       PHCNAT.NOMMAE,
       PHCNAT.NOMPAI,
       PHCCJG.NOMCON,
	   PHCEST.ANOCHE,
	   PHCEST.RNENUM,
       PHCEST.RNEORG,
       PHCEST.RNEDAT,
	   PHCEMPA.NUMINS AS INSCRICAO_ORIGEM,
	   PHCEMPA.DATDEM AS DATA_TRANSF,
	   PHCEMPA.MATRIC AS MATRICULA_ORIGEM,
       PHCCAD2.HORDIA,
       PHCCAD2.HORSEM,
       PHCCAD2.HORMES,
       PHCCAD2.CATTRA,
       PHCCAD2.CATSFP,
       PHCSTG.AREATU,
       PHCSTG.NATEST,
       PHCSTG.NIVEST,
       PHCSTG.APOLIC,
       PHCSTG.INSTIT,
       PHCSTG.AGENTE,
       PHCSTG.NOMCOO,
       PHCSTG.CPFCOO
FROM PHCCAD
LEFT JOIN PHCDOC
	ON PHCDOC.CODEMP = PHCCAD.CODEMP
	AND PHCDOC.CODCAD = PHCCAD.CODCAD
LEFT JOIN PHCEND
	ON PHCEND.CODEMP = PHCCAD.CODEMP
	AND PHCEND.CODCAD = PHCCAD.CODCAD
LEFT JOIN PHCNAT
	ON PHCNAT.CODEMP = PHCCAD.CODEMP
	AND PHCNAT.CODCAD = PHCCAD.CODCAD
LEFT JOIN PHCPIS
	ON PHCPIS.CODEMP = PHCCAD.CODEMP
	AND PHCPIS.CODCAD = PHCCAD.CODCAD
LEFT JOIN PHCEST
	ON PHCEST.CODEMP = PHCCAD.CODEMP
	AND PHCEST.CODCAD = PHCCAD.CODCAD
LEFT JOIN PHCEMPA
	ON PHCEMPA.CODEMP = PHCCAD.CODEMP
	AND PHCEMPA.CODCAD = PHCCAD.CODCAD
LEFT JOIN ULTIMO_CONJUGE
	ON ULTIMO_CONJUGE.CODEMP = PHCCAD.CODEMP
	AND ULTIMO_CONJUGE.CODCAD = PHCCAD.CODCAD
LEFT JOIN PHCCJG
	ON PHCCJG.CODEMP = PHCCAD.CODEMP
	AND PHCCJG.CODCAD = PHCCAD.CODCAD
	AND PHCCJG.SEQUEN = ULTIMO_CONJUGE.SEQUEN
LEFT JOIN ULTIMA_VIGENCIA
	ON ULTIMA_VIGENCIA.CODEMP = PHCCAD.CODEMP
	AND ULTIMA_VIGENCIA.CODCAD = PHCCAD.CODCAD
 LEFT JOIN PHCCAD2
 	ON PHCCAD2.CODEMP = ULTIMA_VIGENCIA.CODEMP
 	AND PHCCAD2.CODCAD = ULTIMA_VIGENCIA.CODCAD
 	AND PHCCAD2.ANOMES = ULTIMA_VIGENCIA.ANOMES
LEFT JOIN PHCSTG
	ON PHCSTG.CODEMP = PHCCAD.CODEMP
	AND PHCSTG.CODCAD = PHCCAD.CODCAD
ORDER BY 1, 2