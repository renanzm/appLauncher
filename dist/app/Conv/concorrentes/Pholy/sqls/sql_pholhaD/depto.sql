WITH ULTIMA_VIGENCIA AS (
	SELECT sub.CODEMP,
	       MAX(sub.ANOMES) AS ANOMES
	FROM PHTEMP2 AS sub
	GROUP BY sub.CODEMP
)
SELECT DISTINCT
       PHCLOT.CODEMP,
       PHCLOT.CODDEP,
       PHTDEP.NOMINT
FROM PHCLOT
INNER JOIN ULTIMA_VIGENCIA
	ON ULTIMA_VIGENCIA.CODEMP = PHCLOT.CODEMP
INNER JOIN PHTEMP2
	ON PHTEMP2.CODEMP = ULTIMA_VIGENCIA.CODEMP
	AND PHTEMP2.ANOMES = ULTIMA_VIGENCIA.ANOMES
INNER JOIN PHTDEP
	ON PHTDEP.CODTAB = PHTEMP2.TABORG
	AND PHTDEP.CODNIV = PHCLOT.CODDEP