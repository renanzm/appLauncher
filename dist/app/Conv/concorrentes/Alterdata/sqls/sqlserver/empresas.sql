SELECT emp.cdempresa,
       emp.nmempresa,
       emp.nmfantasia,
       emp.dsatividade,
       emp.dsendereco,
       emp.endereco_complemento,
       emp.nmbairro,
       emp.nmcidade,
       emp.nrcep,
       emp.cduf,
       emp.nrtelefone,
       emp.nrinscrmunicipal,
       emp.nrinscrestadual,
       emp.nrregcartorio,
       emp.nrregjuntacomercial,
       emp.dtregjuntacomercial,
       emp.vlcapital,
       emp.dtinicioatividade,
       emp.nrcgc,
       emp.dtfimatividade,
       emp.lancautomatico,
       emp.centrocusto,
       emp.nmemail,
       emp.tpcalculoir,
       emp.cdnaturezajuridica,
       emp.cdcnae,
       emp.trabbureau,
       emp.nmbureau,
       emp.nmresponsavelbureau,
       emp.nrcnpjcpfresponsavel,
       emp.nrcrecicrc,
       emp.nrcpfresponsavel,
       emp.nmenderecobureau,
       emp.cdufbureau,
       emp.nmbairrobureau,
       emp.nmcidadebureau,
       emp.nrcepbureau,
       emp.nrtelefonebureau1,
       emp.nrtelefonebureau2,
       emp.nrtelefonebureau3,
       emp.nmemailbureau,
       emp.stativa,
       emp.stformatologomarca,
       emp.cdnire,
       emp.st_dc,
       emp.nroab,
       emp.dtiniservcont,
       emp.dtfimservcont,
       emp.dtiniservinfo,
       emp.dtfimservinfo,
       emp.cdmunicipio,
       emp.nrsuframa,
       emp.logindc,
       emp.idmunicipio,
       emp.nmnomecompleto,
       emp.nrfax,
       emp.dtconvempresa,
       emp.dtexpedicaonire,
       emp.codigo_susep,
       emp.bairro_completo,
       emp.endereco_completo,
       emp.escritorio_data_entrada,
	   fpas.cdfpas,
	   historico.cdrecolhimentogps,
	   historico.cdterceirogrps,
	   fpas.alempresas,
	   fpas.alterceiros,
	   fpas.alautonomos,
	   emp_banco.codrecolhimento,
	   emp_banco.idbancofgts,
	   emp_banco.idagenciafgts,
	   emp_banco.cdcei,
	   lotacao.codigo AS codigo_esocial,
	   cont.contador_id
FROM wphd.empresa AS emp
LEFT JOIN wdp.empdphistorico AS historico
	ON ISNUMERIC(historico.idempresa) = 1
	AND emp.cdempresa = cast(historico.idempresa AS integer)
	AND historico.dtinicial = (SELECT MIN(sub.dtinicial) FROM wdp.empdphistorico AS sub WHERE sub.idempresa = historico.idempresa)
LEFT JOIN wdp.fpas AS fpas
	ON historico.cdfpasgrps = fpas.idfpas
LEFT JOIN wdp.empdp AS emp_banco
	ON ISNUMERIC(emp_banco.idempresa) = 1
	AND emp.cdempresa = cast(emp_banco.idempresa AS integer)
LEFT JOIN wdp.lotacao_tributaria as lotacao
	ON historico.lotacao_tributaria_id = lotacao.id
LEFT JOIN wcont.empcont as cont
	ON cont.idempresa = emp.cdempresa
ORDER BY 1