SELECT
CD_EMPRESA,
CD_FUNCIONARIO,
DT_LOTACAO,
CD_NIVEL1,
IFNULL(( SELECT max(D.DESCRICAO)
    FROM Estrutura AS D 
   WHERE FUNLOTACAO.CD_EMPRESA = D.CD_EMPRESA
     and FUNLOTACAO.CD_FILIAL = D.CD_FILIAL
	 and FUNLOTACAO.CD_NIVEL1 = D.CD_NIVEL1 
	 and D.cd_nivel2 = 0 
	 AND D.cd_nivel3 = 0 ) , IFNULL(( SELECT max(D.DESCRICAO)
							              FROM Estrutura AS D 
									     WHERE FUNLOTACAO.CD_EMPRESA = D.CD_EMPRESA
										   and D.CD_FILIAL = 1
										   and FUNLOTACAO.CD_NIVEL1 = D.CD_NIVEL1 ),'GERAL')) AS DESCRICAO

FROM FUNLOTACAO

ORDER BY CD_EMPRESA, CD_FUNCIONARIO, DT_LOTACAO