SELECT CD_EMPRESA
      ,CD_FUNCIONARIO
      ,DT_PROCESSAMENTO
      ,TIPO_FERIAS
      ,DT_INICIO_AQUISICAO
      ,DT_FIM_AQUISICAO
      ,DT_INICIO_GOZO
      ,DT_FIM_GOZO
      ,DT_INICIO_ABONO
      ,DT_FIM_ABONO
      ,DT_EMISSAO
      ,DT_RETORNO
      ,VL_SALARIO
      ,NR_FALTAS
      ,VL_BASE_IRRF
      ,VL_DED_DEP_IRRF
      ,VL_OUTRAS_DED_IRRF
      ,DT_PAGAMENTO
      ,ALTERADO
      ,NR_DIAS_FERIAS
      ,OP_RATEIO_FERIAS
      ,DED_IR_MP202_2004
      ,NR_DIAS_FERIAS_MES01
      ,MES01
      ,ANO01
      ,NR_DIAS_FERIAS_MES02
      ,MES02
      ,ANO02
      ,CALC30_OPCAO_SALARIO
      ,CALC30_OPCAO_SALARIO_FEVEREIRO
      ,CALC30_OPCAO_DIAS
      ,DT_NOVA_AQUISICAO
      ,VL_ABONO
      ,SEQ_PROCESSAMENTO
      ,DIAS_FERIAS
      ,SALDO_FERIAS
      ,NR_DIAS_FERIAS_MES03
      ,MES03
      ,ANO03
      ,FERIAS_TRIBUTADA
      ,OP_FERIAS_SUPERIOR_30_DIAS
      ,TRANSFERIDO
      ,PERDA_DIREITO_PA
      ,PERIODO_ESTENDIDO
      ,GERA_ESOCIAL
      ,OP_TERCO_FERIAS_MP927
      ,OP_ABONO_MP927
      ,FERIAS_ABONO_QUITADO_MP927
      ,DT_QUITACAO_FERIAS_MP927
      ,FERIAS_TERCO_QUITADO_MP927,
       DATEDIFF(FERIAS.DT_INICIO_GOZO,'1900-01-01') AS DIAS_INI_GOZO,
	   DATEDIFF(FERIAS.DT_FIM_GOZO,'1900-01-01') AS DIAS_FIM_GOZO,
	   DATEDIFF(FERIAS.DT_INICIO_ABONO,'1900-01-01') AS DIAS_INI_ABONO,
	   DATEDIFF(FERIAS.DT_FIM_ABONO,'1900-01-01') AS DIAS_FIM_ABONO,
	   DATEDIFF(FERIAS.DT_FIM_GOZO,FERIAS.DT_INICIO_GOZO)+1 AS CALC_DIAS_GOZO,
	   DATEDIFF(FERIAS.DT_FIM_ABONO,FERIAS.DT_INICIO_ABONO)+1 AS CALC_DIAS_ABONO,
	   (SELECT MAX(F.DT_INICIO_AQUISICAO)
		  FROM FERIAS AS F
		 WHERE FERIAS.CD_EMPRESA = F.CD_EMPRESA
		   AND FERIAS.CD_FUNCIONARIO = F.CD_FUNCIONARIO) AS MAIOR_COMPETENCIA
  FROM FERIAS
  ORDER BY 1,2,5,7