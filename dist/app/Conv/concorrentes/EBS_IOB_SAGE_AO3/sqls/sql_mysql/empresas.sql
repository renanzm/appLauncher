SELECT CRDESTABELECIMENTO.CD_EMPRESA,
CRDESTABELECIMENTO.RAZAO,
CRDESTABELECIMENTO.FANTASIA,
CRDESTABELECIMENTO.ENDERECO,
CRDESTABELECIMENTO.NUMERO,
CRDESTABELECIMENTO.COMPLEMENTO,
CRDESTABELECIMENTO.BAIRRO,
CRDESTABELECIMENTO.CIDADE,
CRDESTABELECIMENTO.CEP,
CRDESTABELECIMENTO.UF,
CRDESTABELECIMENTO.CD_MUNICIPIO,
COALESCE((SELECT MUNICIPIOG.CD_MUNICIPIO_CONCLA 
            FROM MUNICIPIOG 
           WHERE MUNICIPIOG.CD_MUNICIPIO = CRDESTABELECIMENTO.CD_MUNICIPIO 
		     AND MUNICIPIOG.ESTADO = CRDESTABELECIMENTO.UF), (SELECT MAX(MUNICIPIOCGW.CD_MUNICIPIO_IBGE )
															    FROM MUNICIPIOCGW 
															   WHERE MUNICIPIOCGW.CD_MUNICIPIO_IBGE = CRDESTABELECIMENTO.CD_MUNICIPIO  
																 AND MUNICIPIOCGW.UF = CRDESTABELECIMENTO.UF)) AS CODIGO_IBGE,
CRDESTABELECIMENTO.DDD_TELEFONE,
CRDESTABELECIMENTO.TELEFONE,
CRDESTABELECIMENTO.DDD_TELEFONE2,
CRDESTABELECIMENTO.REGISTRO,
CRDESTABELECIMENTO.DDD_FAX,
CRDESTABELECIMENTO.FAX,
CRDESTABELECIMENTO.EMAIL,
CRDESTABELECIMENTO.SITE,
CRDESTABELECIMENTO.NATUREZA_JURIDICA,
CRDESTABELECIMENTO.CNPJ_CPF,
CRDESTABELECIMENTO.INSCRICAO_EST,
CRDESTABELECIMENTO.INSCRICAO_MUN,
CRDESTABELECIMENTO.CODIGO_CEI,
CRDESTABELECIMENTO.CNAE,
CRDESTABELECIMENTO.LOCAL_REGISTRO,
CRDESTABELECIMENTO.DATA_REGISTRO,
CRDESTABELECIMENTO.NOME_TITULAR,
CRDESTABELECIMENTO.DENOM_TITULAR,
CRDESTABELECIMENTO.CPF_TITULAR,
CRDESTABELECIMENTO.RG_TITULAR,
CRDESTABELECIMENTO.CIDADE_TITULAR,
CRDESTABELECIMENTO.ENDERECO_TITULAR,
CRDESTABELECIMENTO.NUMERO_TITULAR,
CRDESTABELECIMENTO.BAIRRO_TITULAR,
CRDESTABELECIMENTO.COMPLEMENTO_TITULAR,
CRDESTABELECIMENTO.UF_TITULAR,
CRDESTABELECIMENTO.CEP_TITULAR,
CRDESTABELECIMENTO.DDD_TELEFONE_TITULAR,
CRDESTABELECIMENTO.TELEFONE_TITULAR,
CRDESTABELECIMENTO.EMAIL_TITULAR,
COALESCE(CRDESTABELECIMENTO.DT_INICIO_ATIVIDADE, COALESCE((SELECT MIN(FUNFUNCIONAL.DT_ADMISSAO) 
                                                         FROM FUNFUNCIONAL
												        WHERE FUNFUNCIONAL.CD_EMPRESA = CRDESTABELECIMENTO.CD_EMPRESA), CURRENT_DATE()) ) AS DT_INICIO_ATIVIDADE,
(SELECT MAX(crdestabelecimentovigencia.ESOCIAL_CAEPF) FROM crdestabelecimentovigencia WHERE crdestabelecimentovigencia.CD_EMPRESA = CRDESTABELECIMENTO.CD_EMPRESA) AS CAEPF,
CRDESTABELECIMENTO.STATUS,
CRDESTABELECIMENTO.ATIVIDADES,
(SELECT min(CRDEstabelecimentoParametro.tipo_logradouro) FROM CRDEstabelecimentoparametro WHERE CRDEstabelecimentoParametro.CD_EMPRESA = CRDESTABELECIMENTO.CD_EMPRESA) AS TIPO_LOGRADOURO,
CRDESTABELECIMENTO.CD_RESPONSAVEL_ESTABELECIMENTO


FROM CRDESTABELECIMENTO

WHERE TIPO_ESTABELECIMENTO = 'M'		

ORDER BY CRDESTABELECIMENTO.CD_EMPRESA