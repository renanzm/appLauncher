SELECT 
    PE.CD_EMPRESA,
    EV.CD_EVENTO,
    EV.DESCRICAO,
    EG.INTEGRA_13,
    EG.INTEGRA_FERIAS
FROM (
    SELECT DISTINCT
        CD_EMPRESA,
        CD_EVENTO
    FROM PROCEVENTO
    WHERE TIPO = 2
      AND ANO > 2018
      AND MES > 0
) PE
INNER JOIN (
    SELECT CD_EVENTO, MAX(DT_INICIO) AS MAX_INICIO
    FROM EVENTOGVIGENCIA
    GROUP BY CD_EVENTO
) EV_MAX
    ON PE.CD_EVENTO = EV_MAX.CD_EVENTO
INNER JOIN EVENTOGVIGENCIA EV
    ON EV.CD_EVENTO = EV_MAX.CD_EVENTO
   AND EV.DT_INICIO = EV_MAX.MAX_INICIO
LEFT JOIN EVENTOG EG
    ON EG.CD_EVENTO = EV.CD_EVENTO
ORDER BY PE.CD_EMPRESA, EV.CD_EVENTO;
