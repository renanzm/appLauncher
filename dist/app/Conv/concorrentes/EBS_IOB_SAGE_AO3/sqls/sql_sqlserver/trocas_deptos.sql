SELECT
CD_EMPRESA,
CD_FUNCIONARIO,
DT_LOTACAO,
CD_NIVEL1,
ISNULL(( SELECT max(D.DESCRICAO)
    FROM EBS_Cordilheira.DBO.Estrutura AS D 
   WHERE EBS_Cordilheira.DBO.FUNLOTACAO.CD_EMPRESA = D.CD_EMPRESA
     and EBS_Cordilheira.DBO.FUNLOTACAO.CD_FILIAL = D.CD_FILIAL
	 and EBS_Cordilheira.DBO.FUNLOTACAO.CD_NIVEL1 = D.CD_NIVEL1 
	 and D.cd_nivel2 = 0 
	 AND D.cd_nivel3 = 0 ) , ISNULL(( SELECT max(D.DESCRICAO)
							              FROM EBS_Cordilheira.DBO.Estrutura AS D 
									     WHERE EBS_Cordilheira.DBO.FUNLOTACAO.CD_EMPRESA = D.CD_EMPRESA
										   and D.CD_FILIAL = 1
										   and EBS_Cordilheira.DBO.FUNLOTACAO.CD_NIVEL1 = D.CD_NIVEL1 ),'GERAL')) AS DESCRICAO

FROM EBS_Cordilheira.DBO.FUNLOTACAO

ORDER BY CD_EMPRESA, CD_FUNCIONARIO, DT_LOTACAO