WITH TB_EVENTO AS (
  SELECT CD_EVENTO,
         MAX(DT_INICIO) AS MAX_INICIO
    FROM EBS_CORDILHEIRA.DBO.EVENTOGVIGENCIA
   GROUP BY CD_EVENTO),
TB_EMPRESA AS (
  SELECT DISTINCT
         CD_EMPRESA,
         CD_EVENTO
    FROM EBS_CORDILHEIRA.DBO.PROCEVENTO
   WHERE TIPO = 2
     AND ANO > 2018
     AND MES > 0
)
SELECT TB_EMPRESA.CD_EMPRESA,
       EVENTOGVIGENCIA.CD_EVENTO,
       EVENTOGVIGENCIA.DESCRICAO,
       EVENTOG.INTEGRA_13,
       EVENTOG.INTEGRA_FERIAS
  FROM TB_EMPRESA
 INNER JOIN EBS_CORDILHEIRA.DBO.EVENTOGVIGENCIA
    ON EVENTOGVIGENCIA.CD_EVENTO = TB_EMPRESA.CD_EVENTO
 INNER JOIN TB_EVENTO
    ON TB_EVENTO.CD_EVENTO = EVENTOGVIGENCIA.CD_EVENTO
   AND TB_EVENTO.MAX_INICIO = EVENTOGVIGENCIA.DT_INICIO
  LEFT JOIN EBS_CORDILHEIRA.DBO.EVENTOG
    ON EVENTOG.CD_EVENTO = EVENTOGVIGENCIA.CD_EVENTO
 ORDER BY CD_EMPRESA, CD_EVENTO