SELECT FUNFUNCIONAL.CD_EMPRESA,
FUNFUNCIONAL.CD_FUNCIONARIO,
FUNCIONARIO.NOME,
FUNFUNCIONAL.DT_ADMISSAO,
FUNFUNCIONAL.VINCULO_EMPREGATICIO_RAIS,
FUNFUNCIONAL.CODIGO_ADMISSAO_CAGED,
FUNFUNCIONAL.NR_REGISTRO,
FUNFUNCIONAL.DIAS_EXPERIENCIA,
FUNFUNCIONAL.DIAS_EXPERIENCIA_PRO,
FUNFUNCIONAL.CD_SINDICATO,
FUNFUNCIONAL.SINDICALIZADO,
FUNFUNCIONAL.SITUACAO_CONTR_SINDICAL,
FUNFUNCIONAL.NR_CARTAO_PONTO,
FUNFUNCIONAL.CATEGORIA,
FUNFUNCIONAL.OCORRENCIA,
FUNFUNCIONAL.NR_CONTA_DEPOSITO,
FUNFUNCIONAL.DV_CONTA_DEPOSITO,
FUNFUNCIONAL.DEFICIENTE_FISICO,
FUNCIONARIO.ENDERECO,
FUNCIONARIO.NR_ENDERECO,
FUNCIONARIO.COMPL_ENDERECO,
FUNCIONARIO.BAIRRO,
FUNCIONARIO.CIDADE,
FUNCIONARIO.ESTADO,
FUNCIONARIO.CEP,
FUNCIONARIO.PAI,
FUNCIONARIO.MAE,
FUNCIONARIO.SEXO,
FUNCIONARIO.ESTADO_CIVIL,
FUNCIONARIO.NACIONALIDADE,
FUNCIONARIO.ANO_CHEGADA,
FUNCIONARIO.GRAU_INSTRUCAO,
FUNCIONARIO.DT_NASCIMENTO,
FUNCIONARIO.DDD_FONE,
FUNCIONARIO.TELEFONE,
FUNCIONARIO.DDD_CELULAR,
FUNCIONARIO.CELULAR,
FUNCIONARIO.RACA,
FUNCIONARIO.DEFICIENTE,
FUNCIONARIO.CIDADE_NASCIMENTO,
FUNCIONARIO.ESTADO_NASCIMENTO,
FUNCIONARIO.NOMECOMPLETO,
FUNDOCUMENTO.NR_CARTEIRA,
FUNDOCUMENTO.SERIE_CARTEIRA,
FUNDOCUMENTO.DV_SERIE_CARTEIRA,
FUNDOCUMENTO.UF_CARTEIRA,
FUNDOCUMENTO.DT_EMISSAO_CARTEIRA,
FUNDOCUMENTO.PIS,
FUNDOCUMENTO.CPF,
FUNDOCUMENTO.DT_EMISSAO_PIS,
FUNDOCUMENTO.NR_IDENTIDADE,
FUNDOCUMENTO.ORGAO_IDENTIDADE,
FUNDOCUMENTO.UF_IDENTIDADE,
FUNDOCUMENTO.NR_HABILITACAO,
FUNDOCUMENTO.CATEGORIA_HABILITACAO,
FUNDOCUMENTO.VCTO_HABILITACAO,
FUNDOCUMENTO.NR_TITULO,
FUNDOCUMENTO.ZONA_TITULO,
FUNDOCUMENTO.SECAO_TITULO,
FUNDOCUMENTO.CERTIFICADO_MILITAR,
FUNDOCUMENTO.NOVO_NR_TITULO,
FUNDOCUMENTO.NOVO_NR_HABILITACAO,
/* SELECIONA O PRÓXIMO VENCIMENTO DE FÉRIAS */
(SELECT MAX(FERIAS.DT_FIM_AQUISICAO+366)
   FROM EBS_CORDILHEIRA.DBO.FERIAS
  WHERE FERIAS.CD_EMPRESA = FUNFUNCIONAL.CD_EMPRESA
    AND FERIAS.CD_FUNCIONARIO = FUNFUNCIONAL.CD_FUNCIONARIO
    AND FERIAS.TIPO_FERIAS = 'N'
    AND FERIAS.DT_FIM_GOZO IS NOT NULL) AS VENC_FERIAS,
(SELECT MAX(FUNLOTACAO.CD_FILIAL)
   FROM EBS_CORDILHEIRA.DBO.FUNLOTACAO
  WHERE FUNLOTACAO.CD_EMPRESA = FUNFUNCIONAL.CD_EMPRESA
	AND FUNLOTACAO.CD_FUNCIONARIO = FUNFUNCIONAL.CD_FUNCIONARIO
    AND FUNLOTACAO.dt_lotacao = (SELECT MAX(F.dt_lotacao)     
	   							   FROM EBS_CORDILHEIRA.DBO.FUNLOTACAO AS F
								  WHERE F.CD_EMPRESA = FUNFUNCIONAL.CD_EMPRESA
								    AND F.CD_FUNCIONARIO = FUNFUNCIONAL.CD_FUNCIONARIO) ) AS I_FILIAL,	
	
/*(SELECT MAX(FUNTOMADOR.CD_TOMADOR)
   FROM EBS_CORDILHEIRA.DBO.FUNTOMADOR
  WHERE FUNTOMADOR.CD_EMPRESA = FUNFUNCIONAL.CD_EMPRESA
    AND FUNTOMADOR.CD_FUNCIONARIO = FUNFUNCIONAL.CD_FUNCIONARIO) AS I_SERVICO, */

  FUNDOCUMENTO.DT_EMISSAO_IDENTIDADE,
  FUNCIONARIO.EMAIL,
  FUNFUNCIONAL.NR_CONTA_DEPOSITO,
  FUNFUNCIONAL.NR_AGENCIA_DEPOSITO,
  FUNFUNCIONAL.CD_BANCO_DEPOSITO,
  FUNFUNCIONAL.DV_AGENCIA_DEPOSITO,
  FUNFUNCIONAL.DV_CONTA_DEPOSITO,
  FUNFUNCIONAL.OPERACAO_DEPOSITO,
  FUNDOCUMENTO.UF_HABILITACAO,
  FUNDOCUMENTO.ORGAO_EMISSOR_CNH,
  FUNDOCUMENTO.DT_PRIMEIRA_HABILITACAO,
  FUNDOCUMENTO.DT_EMISSAO_HABILITACAO,
  FUNCIONARIO.CD_MUNICIPIO_NASCIMENTO,
  FUNFUNCIONAL.CD_CATEGORIA_ESOCIAL,
  COALESCE(CONVERT(VARCHAR(10), '01/'+CRHFUNTRANSFERENCIAEMPRESAS.MES_ANO_TRANSFERENCIA, 101),CRHFUNCIONARIOTIPOADMISSAO.DT_INICIO_VINCULO) AS DATA_TRANSFERENCIA,
  COALESCE((SELECT MAX(CRDESTABELECIMENTO.CNPJ_CPF) 
              FROM EBS_CORDILHEIRA.DBO.CRDESTABELECIMENTO 
			 WHERE CRHFUNTRANSFERENCIAEMPRESAS.CD_EMPRESA_ORIGEM = CRDESTABELECIMENTO.CD_EMPRESA),CRHFUNCIONARIOTIPOADMISSAO.CNPJ_EMPREGADOR_ANTERIOR) AS INSCRICAO_EMPRESA_ORIGEM, 
  CRHFUNTRANSFERENCIAEMPRESAS.CD_FUNCIONARIO_ORIGEM,
  CRHFUNCIONARIOTIPOADMISSAO.NR_MATRICULA_ANTERIOR,
  CRHFUNCIONARIOREINTEGRADO.TIPO_REINTEGRACAO,
  CRHFUNCIONARIOREINTEGRADO.NUMERO_PROCESSO,
  CRHFUNCIONARIOREINTEGRADO.LEI_ANISTIA,
  CRHFUNCIONARIOREINTEGRADO.DT_RETORNO,
  CRHFUNCIONARIOREINTEGRADO.DT_REINTEGRACAO,
  FUNCIONARIO.MATRICULA_ESOCIAL,
  (SELECT MAX(S.TIPO_SALARIO) 
     FROM EBS_CORDILHEIRA.DBO.FUNSALARIO AS S
	WHERE S.CD_EMPRESA= EBS_CORDILHEIRA.DBO.FUNFUNCIONAL.CD_EMPRESA
	  AND S.CD_FUNCIONARIO= EBS_CORDILHEIRA.DBO.FUNFUNCIONAL.CD_FUNCIONARIO
	  AND S.DT_SALARIO = (SELECT MAX(S2.DT_SALARIO) 
	                          FROM EBS_CORDILHEIRA.DBO.FUNSALARIO AS S2
							 WHERE S.CD_EMPRESA= S2.CD_EMPRESA
	                           AND S.CD_FUNCIONARIO= S2.CD_FUNCIONARIO)) AS TIPO_SALARIO,
  (SELECT MAX(S.NR_HORAS_SEMANAIS) 
     FROM EBS_CORDILHEIRA.DBO.FUNSALARIO AS S
	WHERE S.CD_EMPRESA= EBS_CORDILHEIRA.DBO.FUNFUNCIONAL.CD_EMPRESA
	  AND S.CD_FUNCIONARIO= EBS_CORDILHEIRA.DBO.FUNFUNCIONAL.CD_FUNCIONARIO
	  AND S.DT_SALARIO = (SELECT MAX(S2.DT_SALARIO) 
	                          FROM EBS_CORDILHEIRA.DBO.FUNSALARIO AS S2
							 WHERE S.CD_EMPRESA= S2.CD_EMPRESA
	                           AND S.CD_FUNCIONARIO= S2.CD_FUNCIONARIO)) AS HORAS_SEMANAIS,
   COALESCE((SELECT MAX(MUNICIPIOG.CD_MUNICIPIO_CONCLA )
			   FROM EBS_Cordilheira.DBO.MUNICIPIOG 
			  WHERE MUNICIPIOG.CD_MUNICIPIO = FUNCIONARIO.CD_MUNICIPIO  
			    AND MUNICIPIOG.ESTADO = FUNCIONARIO.ESTADO), (SELECT MAX(MUNICIPIOCGW.CD_MUNICIPIO_IBGE )
															    FROM EBS_Cordilheira.DBO.MUNICIPIOCGW 
															   WHERE MUNICIPIOCGW.CD_MUNICIPIO_IBGE = FUNCIONARIO.CD_MUNICIPIO  
																 AND MUNICIPIOCGW.UF = FUNCIONARIO.ESTADO)) AS CODIGO_IBGE_ENDERECO,
   COALESCE((SELECT MAX(MUNICIPIOG.CD_MUNICIPIO_CONCLA )
			   FROM EBS_Cordilheira.DBO.MUNICIPIOG 
			  WHERE MUNICIPIOG.CD_MUNICIPIO = FUNCIONARIO.CD_MUNICIPIO_NASCIMENTO  
			    AND MUNICIPIOG.ESTADO = FUNCIONARIO.ESTADO_NASCIMENTO), (SELECT MAX(MUNICIPIOCGW.CD_MUNICIPIO_IBGE )
																		   FROM EBS_Cordilheira.DBO.MUNICIPIOCGW 
																		  WHERE MUNICIPIOCGW.CD_MUNICIPIO_IBGE = FUNCIONARIO.CD_MUNICIPIO_NASCIMENTO  
																			AND MUNICIPIOCGW.UF = FUNCIONARIO.ESTADO_NASCIMENTO)) AS CODIGO_IBGE_NASCIMENTO
  
FROM EBS_CORDILHEIRA.DBO.FUNFUNCIONAL
LEFT OUTER JOIN EBS_CORDILHEIRA.DBO.FUNCIONARIO

ON FUNFUNCIONAL.CD_EMPRESA = FUNCIONARIO.CD_EMPRESA
AND FUNFUNCIONAL.CD_FUNCIONARIO = FUNCIONARIO.CD_FUNCIONARIO

LEFT OUTER JOIN EBS_CORDILHEIRA.DBO.FUNDOCUMENTO

ON FUNCIONARIO.CD_EMPRESA = FUNDOCUMENTO.CD_EMPRESA AND
FUNCIONARIO.CD_FUNCIONARIO = FUNDOCUMENTO.CD_FUNCIONARIO

LEFT OUTER JOIN EBS_CORDILHEIRA.DBO.CRHFUNTRANSFERENCIAEMPRESAS

ON FUNDOCUMENTO.CD_EMPRESA = CRHFUNTRANSFERENCIAEMPRESAS.CD_EMPRESA_DESTINO AND
FUNDOCUMENTO.CD_FUNCIONARIO = CRHFUNTRANSFERENCIAEMPRESAS.CD_FUNCIONARIO_DESTINO

LEFT OUTER JOIN EBS_CORDILHEIRA.DBO.CRHFUNCIONARIOTIPOADMISSAO

ON FUNDOCUMENTO.CD_EMPRESA = CRHFUNCIONARIOTIPOADMISSAO.CD_EMPRESA AND
FUNDOCUMENTO.CD_FUNCIONARIO = CRHFUNCIONARIOTIPOADMISSAO.CD_FUNCIONARIO

LEFT OUTER JOIN EBS_CORDILHEIRA.DBO.CRHFUNCIONARIOREINTEGRADO

ON FUNDOCUMENTO.CD_EMPRESA = CRHFUNCIONARIOREINTEGRADO.CD_EMPRESA AND
FUNDOCUMENTO.CD_FUNCIONARIO = CRHFUNCIONARIOREINTEGRADO.CD_FUNCIONARIO

ORDER BY FUNFUNCIONAL.CD_EMPRESA, FUNFUNCIONAL.CD_FUNCIONARIO