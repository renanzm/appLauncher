SELECT
  ESO_CODEMP,
  ESO_CDFUNC,
  ESO_NR_RECIBO,
  CASE
    WHEN ESO_TPEV = 10 THEN
      SUBSTRING(ESO_KEY FROM POSITION('|' IN ESO_KEY) + 1)
    ELSE
      ESO_KEY
  END AS ESO_KEY,
  ESO_TPEV
FROM GER_ESOCIAL_EVENTOS
WHERE ESO_TPEV IN (1, 10)
  AND ESO_NR_RECIBO <> ''
ORDER BY ESO_CODEMP;