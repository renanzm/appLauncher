SELECT R.CD_EMPRESA,
       R.CD_FUNCIONARIO,
	   R.DT_AFASTA
FROM RHRESCISAO AS R
WHERE R.DT_AFASTA = (SELECT MAX(R2.DT_AFASTA) 
                       FROM RHRESCISAO as R2
				      WHERE R2.CD_EMPRESA = R.CD_EMPRESA
				        AND R2.CD_FUNCIONARIO = R.CD_FUNCIONARIO)
	AND LEFT(DT_AFASTA,4) <> '1900'
						
UNION

SELECT F.CD_EMPRESA,
       F.CD_FUNCIONARIO,
	   F.DT_AFASTA
FROM RHFUNCIONARIO AS F
WHERE NOT EXISTS (SELECT 1 
                    FROM RHRESCISAO as R2
				   WHERE R2.CD_EMPRESA = F.CD_EMPRESA
				     AND R2.CD_FUNCIONARIO = F.CD_FUNCIONARIO)
	AND LEFT(DT_AFASTA,4) <> '1900'
ORDER BY 1,2